#
#
#
# BEHEER HOMONIEMEN -1
#
#
#


#Hoofdpagina Homoniemen -1 Rapportage
stage:TaxHomoniemen a elmo:Representation;
	elmo:url-pattern "/query/homoniemen1$";
	elmo:contains stage:TaxHeader;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxBeheermenu;
	elmo:contains stage:TaxHomoniemenTabel;
	elmo:contains stage:TaxHomoniemenUitleg;
.

stage:TaxHomoniemenUitleg a elmo:Part;
	elmo:appearance elmo:HtmlAppearance;
	elmo:index "1";
	elmo:without-parameter "term";
	elmo:data [
		rdfs:label "Homoniemen";
	]
.

# Weergave van homoniemen
stage:TaxHomoniemenTabel a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "2";
	elmo:query stage:TaxHomoniemenQuery;
	elmo:fragment [
		rdfs:label "Concept";		
		elmo:applies-to "conceptlabel";
		elmo:index "1";
	];
	elmo:fragment [
		rdfs:label "Dataset";		
		elmo:applies-to "datasetlabel";
		elmo:index "2";
	];
	elmo:fragment [
		rdfs:label "Status";		
		elmo:applies-to "statuslabel";
		elmo:index "2";
	];
.

#query geeft aan of een begrip in meerdere domeinen voorkomt
stage:TaxHomoniemenQuery a elmo:query;
	elmo:query '''
		PREFIX doc: <http://localhost:8080/catalogus/tax/concepten/doc/>
		PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
		PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
		PREFIX prov: <http://www.w3.org/ns/prov#>
		PREFIX kddef: <http://kadaster.basisregistraties.overheid.nl/som/def#>
		PREFIX container: <http://localhost:8080/catalogus/tax/container/>
		SELECT ?conceptlabel ?datasetlabel ?statuslabel
		WHERE {
			{
				SELECT DISTINCT ?concept
				WHERE {
					GRAPH doc:mastergraph {
						?concept skos:inScheme ?dataset.
					}
				}
				GROUP BY ?concept
				HAVING (COUNT(?concept) > 1 )
			}
			GRAPH ?cg {
				?concept rdfs:label ?conceptlabel.
				?concept kddef:status ?status.
				FILTER NOT EXISTS {
					?concept prov:invalidatedAtTime ?time.
				}
			}
			GRAPH ?dsg {
				?dataset rdfs:label ?datasetlabel. 
				FILTER NOT EXISTS {
					?dataset prov:invalidatedAtTime ?time.
				}
			}
			OPTIONAL {
				GRAPH container:statusupload {
					?status rdfs:label ?statuslabel.
					FILTER (lang(?statuslabel)="" || lang(?statuslabel)="nl")
				}
			}
			FILTER( LANG( ?conceptlabel ) = "" || LANGMATCHES( LANG( ?conceptlabel ), "nl" ) )
			FILTER( LANG( ?datasetlabel ) = "" || LANGMATCHES( LANG( ?datasetlabel ), "nl" ) )
			GRAPH doc:mastergraph {
				?concept rdfs:isDefinedBy ?cg.
				?dataset rdfs:isDefinedBy ?dsg.
			}
		}
	'''
.