#
#
#
# BEHEER HOMONIEMEN -1
#
#
#


#Hoofdpagina Homoniemen -1 Rapportage
stage:TaxHomoniemen a elmo:Representation;
	elmo:url-pattern "/query/homoniemen1$";
	elmo:contains stage:TaxHeader;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxBeheermenu;
	elmo:contains stage:TaxHomoniemenTabel;
	elmo:contains stage:TaxHomoniemenUitleg;
.

stage:TaxHomoniemenUitleg a elmo:Part;
	elmo:appearance elmo:HtmlAppearance;
	elmo:index "1";
	elmo:without-parameter "term";
	elmo:data [
		rdfs:label "Homoniemen";
	]
.

# Weergave van homoniemen
stage:TaxHomoniemenTabel a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "2";
	elmo:query stage:TaxHomoniemenQuery;
	elmo:fragment [
		rdfs:label "Concept";		
		elmo:applies-to "conceptlabel";
	];
		elmo:fragment [
		rdfs:label "Dataset";		
		elmo:applies-to "datasetlabel";
	];
.

#query geeft aan of een begrip in meerdere domeinen voorkomt
stage:TaxHomoniemenQuery a elmo:query;
	elmo:query '''
		PREFIX doc: <http://localhost:8080/catalogus/tax/concepten/doc/>
		PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
		PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
		PREFIX prov: <http://www.w3.org/ns/prov#>
		SELECT ?conceptlabel ?datasetlabel
		WHERE {
			{
				SELECT DISTINCT ?concept  (COUNT(?concept) AS ?total)
				WHERE {
					GRAPH doc:mastergraph {
						?concept skos:inScheme ?dataset.
					}
				}
				GROUP BY ?concept
				HAVING (COUNT(?concept) > 1 )
			}
			GRAPH ?cg {
				?concept rdfs:label ?conceptlabel
				FILTER NOT EXISTS {
					?concept prov:invalidatedAtTime ?time.
				}
			}
			GRAPH ?dsg {
				?dataset rdfs:label ?datasetlabel. 
				FILTER NOT EXISTS {
					?dataset prov:invalidatedAtTime ?time.
				}
			}
			FILTER( LANG( ?conceptlabel ) = "" || LANGMATCHES( LANG( ?conceptlabel ), "nl" ) )
			FILTER( LANG( ?datasetlabel ) = "" || LANGMATCHES( LANG( ?datasetlabel ), "nl" ) )
			GRAPH doc:mastergraph {
				?concept rdfs:isDefinedBy ?cg.
				?dataset rdfs:isDefinedBy ?dsg.
				?concept skos:inScheme ?dataset.
			}
		}
	'''
.