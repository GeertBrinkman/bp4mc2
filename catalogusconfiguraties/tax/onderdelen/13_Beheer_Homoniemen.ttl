#
#
#
# BEHEER HOMONIEMEN -1
#
#
#


#Hoofdpagina Homoniemen -1 Rapportage
stage:TaxHomoniemen a elmo:Representation;
	elmo:url-pattern "/query/homoniemen1$";
	elmo:contains stage:TaxHeader;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxBeheermenu;
	elmo:contains stage:TaxHomoniemenTabel;
	elmo:contains stage:TaxHomoniemenUitleg;
.

stage:TaxHomoniemenUitleg a elmo:Part;
	elmo:appearance elmo:HtmlAppearance;
	elmo:index "1";
	elmo:without-parameter "term";
	elmo:data [
		rdfs:label "Homoniemen";
	]
.

# Weergave van homoniemen
stage:TaxHomoniemenTabel a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "2";
	elmo:query stage:TaxHomoniemenQuery;
	elmo:fragment [
		rdfs:label "Concept";		
		elmo:applies-to "conceptlabel";
		elmo:index "1";
	];
	elmo:fragment [
		rdfs:label "Populatie";		
		elmo:applies-to "dataset1label";
		elmo:index "2";
	];
	elmo:fragment [
		rdfs:label "Met status";		
		elmo:applies-to "status1label";
		elmo:index "3";
	];
	elmo:fragment [
		rdfs:label "Komt ook voor in";		
		elmo:applies-to "dataset2label";
		elmo:index "4";
	];
	elmo:fragment [
		rdfs:label "Met status";		
		elmo:applies-to "status2label";
		elmo:index "5";
	];
.

#query geeft aan of een begrip in meerdere domeinen voorkomt
stage:TaxHomoniemenQuery a elmo:query;
	elmo:query '''
		PREFIX doc: <http://localhost:8080/catalogus/tax/concepten/doc/>
		PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
		PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
		PREFIX prov: <http://www.w3.org/ns/prov#>
		PREFIX kddef: <http://kadaster.basisregistraties.overheid.nl/som/def#>
		PREFIX container: <http://localhost:8080/catalogus/tax/container/>
		SELECT DISTINCT ?conceptlabel ?dataset1label ?status1label ?dataset2label ?status2label
		WHERE {
			GRAPH ?g {
				?concept skos:prefLabel ?conceptlabel.
				?concept kddef:status ?status1.
				FILTER NOT EXISTS {
					?concept prov:invalidatedAtTime ?c1time.
				}
			}
			GRAPH ?g2 {
				?concept2 skos:prefLabel ?conceptlabel.
				?concept2 kddef:status ?status2.
				FILTER NOT EXISTS {
					?concept2 prov:invalidatedAtTime ?c2time.
				}
			}
			GRAPH ?dsg {
				?dataset1 rdfs:label ?dataset1label. 
				FILTER NOT EXISTS {
					?dataset1 prov:invalidatedAtTime ?d1time.
				}
				?dataset2 rdfs:label ?dataset2label. 
				FILTER NOT EXISTS {
					?dataset2 prov:invalidatedAtTime ?d2time.
				}
			}
			OPTIONAL {
				GRAPH container:statusupload {
					?status1 rdfs:label ?status1label.
					?status2 rdfs:label ?status2label.
					FILTER (lang(?status1label)="" || lang(?status1label)="nl")
					FILTER (lang(?status2label)="" || lang(?status2label)="nl")
				}
			}
			GRAPH doc:mastergraph {
				?concept rdfs:isDefinedBy ?g.
				?concept2 rdfs:isDefinedBy ?g2. 
				?dataset rdfs:isDefinedBy ?dsg.
				?concept skos:inScheme ?dataset1.
				?concept2 skos:inScheme ?dataset2.
			}
			FILTER (?concept != ?concept2)
		}
	'''
.