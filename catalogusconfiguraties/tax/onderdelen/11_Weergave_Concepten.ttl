@prefix stage: <http://localhost:8080/catalogus/tax/stage#>.
@prefix updatestage: <http://localhost:8080/catalogus/tax/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://localhost:8080/catalogus/tax/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# PAGINA'S (REPRESENTATIONS)
#

# Weergavepagina inclusief versies en grafische weergave
stage:WeergavePaginaConcepten a elmo:Representation;
	elmo:contains stage:TaxMenu;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxIndexConcepten;
	elmo:contains stage:WeergaveTabelConcepten;
	elmo:applies-to [ rdf:type skos:Concept ];
	elmo:uri-pattern "/id/concept/";
.

#
# HERBRUIKBARE PAGINA-ONDERDELEN (PARTS)
#

# Algemene tabelweergave
stage:WeergaveTabelConcepten a elmo:Part;
	elmo:index "01";
	elmo:fragment [
		elmo:applies-to rdfs:label;
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		rdfs:label "Uitleg"@nl;
		elmo:applies-to skos:comment;
		elmo:index "2";
	];
	elmo:fragment [
		rdfs:label "Definitie"@nl;
		elmo:applies-to skos:definition;
		elmo:index "3";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:fragment [
		rdfs:label "Toelichting"@nl;
		elmo:applies-to skos:scopeNote;
		elmo:index "4";
	];
	elmo:fragment [ 
		rdfs:label "Bron"@nl;
		elmo:applies-to dct:source;
		elmo:appearance elmo:GlobalLink;
		elmo:index "5";
	];
	elmo:fragment [
		rdfs:label "Domein"@nl;
		elmo:applies-to skos:inScheme;
		elmo:index "6";
	];
	elmo:fragment [ 
		rdfs:label "Is specialisatie van"@nl;
		elmo:applies-to thes:broaderGeneric;
		elmo:index "7";
	];
	elmo:fragment [
		rdfs:label "Is generalisatie van"@nl;
		elmo:applies-to thes:narrowerGeneric;
		elmo:index "8";
	];
	elmo:fragment [ 
		rdfs:label "Is onderdeel van"@nl;
		elmo:applies-to thes:broaderPartitive;
		elmo:index "9";
	];
	elmo:fragment [
		rdfs:label "Bestaat uit"@nl;
		elmo:applies-to thes:narrowerPartitive;
		elmo:index "10";
	];
	elmo:fragment [
		rdfs:label "Heeft betrekking op"@nl;
		elmo:applies-to skos:semanticRelation;
		elmo:indx "11";
	];
	elmo:fragment [
		rdfs:label "Synoniemen"@nl;
		elmo:applies-to skos:altLabel;
		elmo:indx "12";
	];
	elmo:fragment [
		rdfs:label "Lid van"@nl;
		elmo:applies-to skos:member;
		elmo:indx "16";
	];
	elmo:fragment [
		rdfs:label "Is ongeveer hetzelfde als"@nl;
		elmo:applies-to skos:closeMatch;
		elmo:index "21";
	];
	elmo:fragment [
		rdfs:label "Is hetzelfde als"@nl;
		elmo:applies-to skos:exactMatch;
		elmo:index "22";
	];		
	elmo:fragment [
		rdfs:label "zie ook (in ander schema)"@nl;
		elmo:applies-to skos:relatedMatch;
		elmo:index "23";
	];
	elmo:fragment [
		rdfs:label "Is breder dan (in ander schema)"@nl;
		elmo:applies-to skos:broadMatch;
		elmo:index "24";
	];
	elmo:fragment [
		rdfs:label "Is enger dan (in ander schema)"@nl;
		elmo:applies-to skos:narrowMatch;
		elmo:index "25";
	];
	elmo:query stage:WeergaveTabelConceptenQuery;
.

#
# QUERY'S VOOR PAGINA'S/PARTS
#

# Query voor WeergaveTabel
stage:WeergaveTabelConceptenQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix container: <http://localhost:8080/catalogus/tax/container/>
		prefix doc: <http://localhost:8080/catalogus/tax/concepten/doc/>
		prefix dataset: <http://localhost:8080/catalogus/tax/id/dataset/>
		prefix concept: <http://localhost:8080/catalogus/tax/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
		
		construct {
			<@SUBJECT@> ?p ?o.
			?o rdfs:label ?olabel.
			<@SUBJECT@> skos:member ?col.
			?col rdfs:label ?col_label.
			<@SUBJECT@> skoslex:refersTo ?s.
			?s rdfs:label ?slabel.
		}
		WHERE {
			{
				{
					GRAPH ?g {
						<@SUBJECT@> ?p ?o.
						<@SUBJECT@> rdf:type skos:Concept.
					}
					GRAPH doc:mastergraph {
						<@SUBJECT@> rdfs:isDefinedBy ?g
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != prov:generatedAtTime
						&& ?p != prov:invalidatedAtTime
						&& ?p != prov:wasGeneratedBy
						&& ?p != dct:valid
						&& ?p != foaf:focus
						&& ?p != skoslex:Actor
						&& ?p != skoslex:Object
						&& ?p != prov:startedAtTime
						&& ?p != prov:endedAtTime
						&& ?p != prov:wasAssociatedWith
						&& ?p != prov:actedOnBehalfOf
					)
					FILTER( substr("@GRAPH@",2) = "GRAPH@")
				}
				UNION
				{
					GRAPH <@GRAPH@> {
						<@SUBJECT@> ?p ?o.
						<@SUBJECT@> rdf:type skos:Concept.
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != prov:generatedAtTime
						&& ?p != prov:invalidatedAtTime
						&& ?p != prov:wasGeneratedBy
						&& ?p != dct:valid
						&& ?p != foaf:focus
						&& ?p != skoslex:Actor
						&& ?p != skoslex:Object
						&& ?p != prov:startedAtTime
						&& ?p != prov:endedAtTime
						&& ?p != prov:wasAssociatedWith
						&& ?p != prov:actedOnBehalfOf
					)
					FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
				}
				OPTIONAL {
					?o rdfs:label ?olabel.
				}
				OPTIONAL {
					GRAPH doc:mastergraph {
						?col rdfs:isDefinedBy ?cg.
					}
					GRAPH ?cg {
						?col skos:member <@SUBJECT@>.
						?col rdfs:label ?col_label.
						FILTER NOT EXISTS {
							?col prov:invalidatedAtTime ?time.
						}
					}
				}
			}
			UNION {
				GRAPH doc:mastergraph {
					?s rdfs:isDefinedBy ?altSubjectGraph.
				}
				GRAPH ?altSubjectGraph {
					{ ?s skoslex:affects <@SUBJECT@> }
					UNION { ?s skoslex:classification <@SUBJECT@> }
					UNION { ?s skoslex:refersTo <@SUBJECT@> }
					FILTER NOT EXISTS {
						?s prov:invalidatedAtTime ?time.
					}
				}
				OPTIONAL {
					GRAPH <http://localhost:8080/catalogus/tr/container/dmn> {
						?s rdfs:label ?slabel.
					}
				}
			}
			UNION {
				SERVICE <http://almere.pilod.nl/sparql> {
					SERVICE <http://data.pdok.nl/sparql> {
						GRAPH brt:top10nl-metadata {
							<@SUBJECT@> ?p ?o.
						}
						FILTER (
							?p != rdf:type
							&& ?p != skos:prefLabel
							&& ?p != skos:notation
							&& ?p != bp4mc2:signature
							&& ?p != dct:type
							&& ?p != skos:member
							&& ?p != prov:generatedAtTime
							&& ?p != prov:invalidatedAtTime
							&& ?p != prov:wasGeneratedBy
							&& ?p != dct:valid
							&& ?p != foaf:focus
							&& ?p != skoslex:Actor
							&& ?p != skoslex:Object
							&& ?p != prov:startedAtTime
							&& ?p != prov:endedAtTime
							&& ?p != prov:wasAssociatedWith
							&& ?p != prov:actedOnBehalfOf
						)				
						OPTIONAL {
							?o rdfs:label ?olabel.
						}
					}
				}
			}
		}
	'''
.