#
#
#
# FRAMEWORK
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
#
#
# PAGINA'S (REPRESENTATIONS)
#
#
#


# Hoofdpagina beheer
stage:TaxBeheerpagina rdf:type elmo:Representation;
	elmo:url-pattern "/admin(|/)$";
	elmo:contains stage:TaxBeheermenu;
	elmo:contains stage:TaxFooter;
	elmo:appearance elmo:HtmlAppearance;
	elmo:data [
		rdfs:label "Tax";
		elmo:html "<div><p>U bent succesvol ingelogd op de beheerpagina.</p></div>"
	]
.


#
#
#
# HERBRUIKBARE PAGINA-ONDERDELEN (PARTS)
#
#
#

#
# Indexloos: Appearance bepaalt plaats op de pagina
#

# Menubalk hoofdmenu
stage:TaxMenu a elmo:Part;
	elmo:appearance elmo:NavbarSearchAppearance;
	elmo:data [
	];
.

# Beheermenu
stage:TaxBeheermenu a elmo:Part;
	elmo:appearance elmo:NavbarSearchAppearance;
	elmo:data [
		elmo:data [
			rdfs:label "BEHEER";
			xhtml:link "/admin";
			elmo:index: "0";
		];
		elmo:data [ 
			rdfs:label "Hoofdpagina";
			elmo:index "1";
			xhtml:link "";
		];
		elmo:data [
			rdfs:label "Upload";
			elmo:index "2";
			elmo:data [
				rdfs:label "Upload concepten (Excel)";
				elmo:index "1";
				xhtml:link "/container/excelupload";
			];
			elmo:data [
				rdfs:label "Upload concepten (RDF of Turtle)";
				elmo:index "2";
				xhtml:link "/container/ttlupload";
			];
			elmo:data [
				rdfs:label "Upload dataset-metadata (RDF of Turtle)";
				elmo:index "3";
				xhtml:link "/container/datasetupload";
			];
		];
		elmo:data [
			rdfs:label "Acties";
			elmo:index "3";
			elmo:data [
				rdfs:label "Verwijder alle data";
				elmo:index "1";
				xhtml:link "/update/clearalldata";
			];
		];
	]
.

# Footer
stage:TaxFooter a elmo:Part;
	elmo:appearance elmo:FooterAppearance;
	elmo:data [
		elmo:html '''
			<div>Waar hierboven sprake is van definities, toelichtingen en uitleg, zijn de daarbij behorende teksten bedoeld om te helpen de basisregistratie Kadaster en communicatie-uitingen van het Kadaster te begrijpen. Het gaat dus niet om echte juridische definities. Voor de juridische betekenis prevaleert altijd de tekst in de formele juridische bron.</div>
		'''^^rdf:html;
	];
.
 
#
#
#
# BEHEER CONCEPTEN
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# CONTAINERS
#

# Uploadcontainer Excel
container:excelupload a elmo:Container;
	elmo:contains stage:TaxBeheermenu;
	elmo:contains stage:TaxFooter;
	elmo:representation elmo:UploadRepresentation;
	elmo:translator elmo:TableExcelTranslator;
	rdfs:label "Upload concepten via Excel (.xls)";
	elmo:replaces container:generiek;
	elmo:query stage:TaxGeneriekeUploadScene;
.

# Uploadcontainer ttl
container:ttlupload a elmo:Container;
	elmo:contains stage:TaxBeheermenu;
	
	elmo:contains stage:TaxFooter;
	elmo:representation elmo:UploadRepresentation;
	rdfs:label "Upload concepten via RDF (.xml) of Turtle (.ttl)";
	elmo:replaces container:generiek;
	elmo:query stage:TaxGeneriekeUploadScene;
.

#
# SCENES
#

# Standaardquery voor uploadcontainers
# Algoritme:
#
# - Verwijder voor de zekerheid de @CURRENTMOMENT@ GRAPH
# - Vul mastergraph aan met nieuwe versie
# - Voeg metadata toe aan nieuwe conceptengraph, activiteitengraph en actorengraph
# - Hash genereren, zodat we kunnen vergelijken of er iets gewijzigd is aan een concept
# - Voeg voor de verwijderde concepten in de oude GRAPH wat metadata toe (prov:invalidatedAtTime)
# - Verwijder de signature van de verwijderde concepten uit de mastergraph
# - Update de aanpasdatum van de Catalogus, CatalogRecord en Dataset
# - Voeg in de nieuwe GRAPH de concepten toe die een andere hash dan de hash in de mastergraph hebben (d.w.z., die gewijzigd zijn)
# - Voeg voor de gewijzigde concepten in de oude GRAPH wat metadata toe (prov:invalidatedAtTime)
# - Verwijder de concepten uit de mastergraph die voorkomen in de nieuwe GRAPH (d.w.z. gewijzigd zijn)
# - Voeg een verwijzing toe in de mastergraph naar de nieuwe GRAPH voor de concepten die in de nieuwe GRAPH staan
# - Verwijder de (tijdelijke) graphs die gebruikt zijn door de uploadcontainers

# Generieke uploadquery
stage:TaxGeneriekeUploadScene a elmo:Scene;
	rdfs:label "Postquery inladen gegevens";
	elmo:index "2";
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix skosxl: <http://www.w3.org/2008/05/skos-xl#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix dctype: <http://purl.org/dc/dcmitype/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix foaf: <http://xmlns.com/foaf/0.1/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix owl: <http://www.w3.org/2002/07/owl#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix loc: <http://pdok-ld-gck.in.kadaster.nl/id/>
		prefix versiongraph: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/@CURRENTMOMENT@>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		prefix activity: <http://pdok-ld-gck.in.kadaster.nl/id/concept/@CURRENTMOMENT@>
			
		
		DELETE FROM versiongraph:version {
            ?s?p?o
		}
		WHERE {
            GRAPH versiongraph:version {
                ?s?p?o
            }
		}
		
		INSERT INTO container:generiek {
			?s rdfs:label ?spreflabel.
		} WHERE {
			GRAPH container:generiek {
				{
					{ ?s skos:prefLabel ?spreflabel. }
					UNION { ?s dct:title ?spreflabel. }
					FILTER NOT EXISTS {
						?s rdfs:label ?slabel.
					}
				}
				UNION {
					?s skosxl:prefLabel/skosxl:literalForm ?spreflabel.
				}
			}
		}
		
		INSERT INTO doc:mastergraph {
            doc:mastergraph rdf:type void:Dataset.
            doc:mastergraph rdfs:label "Concepten".
            versiongraph:version dct:isVersionOf doc:mastergraph.
            dataset:concepten rdf:type skos:ConceptScheme.
            dataset:concepten rdfs:label "Conceptschema".
		}
		
		INSERT INTO versiongraph:version {
            dataset:concepten rdfs:isDefinedBy versiongraph:version.
            versiongraph:version rdfs:label "Concepten - Tax-programma (publicatiedatum @CURRENTMOMENT@)".
            versiongraph:version prov:wasGeneratedBy activity:Upload.
			versiongraph:version rdf:type prov:Entity.
			versiongraph:version prov:generatedAtTime "@CURRENTMOMENT@".
			activity:Upload rdf:type prov:Activity.
			activity:Upload rdfs:label "Upload dataset @CURRENTMOMENT@".
			activity:Upload prov:startedAtTime "@CURRENTMOMENT@".
			activity:Upload prov:wasAssociatedWith concept:tomcatUser.
			concept:tomcatUser rdf:type prov:Agent.
			concept:tomcatUser rdfs:label "Tomcat User".
			concept:tomcatUser foaf:givenName "Tomcat User".
			concept:tomcatUser foaf:mbox "tomcat@user.org".
			concept:tomcatUser prov:actedOnBehalfOf "Apache".
		}

		INSERT INTO container:generiek {
            ?s bp4mc2:signature ?sig.
		}
		WHERE {
			SELECT DISTINCT ?s bif:md5(sql:group_concat(concat(?p,'=',?o),';')) as ?sig
			WHERE {
				GRAPH container:generiek {
					SELECT ?s ?p ?o
					WHERE {
						?s ?p ?o.
						?s rdf:type ?type.
						FILTER (
							?type = skos:Concept
							|| ?type = skos:Collection
							|| ?type = skoslex:Act
							|| ?type = skoslex:Norm
							|| ?type = skoslex:Object
							|| ?type = skoslex:Actor
							|| ?type = owl:Class
							|| ?type = dctype:Text
						)
					}
					ORDER BY ?s ?p ?o
				}
            }
		}
		
		INSERT {
			GRAPH ?g {
				?s prov:invalidatedAtTime "@CURRENTMOMENT@"
			}
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s rdfs:isDefinedBy ?g.
				?s rdf:type ?type.
				FILTER (
					?type = skos:Concept
					|| ?type = skos:Collection
					|| ?type = skoslex:Act
					|| ?type = skoslex:Norm
					|| ?type = skoslex:Object
					|| ?type = skoslex:Actor
					|| ?type = owl:Class
					|| ?type = dctype:Text
				)
			}
			FILTER NOT EXISTS {
				GRAPH container:generiek {
					?s rdf:type ?type.
					FILTER (
						?type = skos:Concept
						|| ?type = skos:Collection
						|| ?type = skoslex:Act
						|| ?type = skoslex:Norm
						|| ?type = skoslex:Object
						|| ?type = skoslex:Actor
						|| ?type = owl:Class
						|| ?type = dctype:Text
					)
				}
			}
			FILTER NOT EXISTS {
				GRAPH ?g {
					?s prov:invalidatedAtTime ?time.
				}
			}
		}
		
		DELETE FROM doc:mastergraph {
			?s bp4mc2:signature ?sig.
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s bp4mc2:signature ?sig.
				?s rdf:type ?type.
				FILTER (
					?type = skos:Concept
					|| ?type = skos:Collection
					|| ?type = skoslex:Act
					|| ?type = skoslex:Norm
					|| ?type = skoslex:Object
					|| ?type = skoslex:Actor
					|| ?type = owl:Class
					|| ?type = dctype:Text
				)
			}
			FILTER NOT EXISTS {
				GRAPH container:generiek {
					?s rdf:type ?type.
					FILTER (
						?type = skos:Concept
						|| ?type = skos:Collection
						|| ?type = skoslex:Act
						|| ?type = skoslex:Norm
						|| ?type = skoslex:Object
						|| ?type = skoslex:Actor
						|| ?type = owl:Class
						|| ?type = dctype:Text
					)
				}
			}
		}
			
		INSERT INTO versiongraph:version {
			?s ?p ?o
		}
		WHERE {
			GRAPH container:generiek {
				?s rdf:type ?type.
			    ?s ?p ?o.
			    ?s bp4mc2:signature ?sig
				FILTER (
					?type = skos:Concept
					|| ?type = skos:Collection
					|| ?type = skoslex:Act
					|| ?type = skoslex:Norm
					|| ?type = skoslex:Object
					|| ?type = skoslex:Actor
					|| ?type = owl:Class
					|| ?type = dctype:Text
				)
			}
			FILTER NOT EXISTS {
				GRAPH doc:mastergraph {
					?s bp4mc2:signature ?sig
				}
			}
		}
		
		INSERT {
			GRAPH ?g {
				?s prov:invalidatedAtTime "@CURRENTMOMENT@"
			}
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s rdfs:isDefinedBy ?g
			}
			GRAPH versiongraph:version {
				?s rdf:type ?type.
				FILTER (
					?type = skos:Concept
					|| ?type = skos:Collection
					|| ?type = skoslex:Act
					|| ?type = skoslex:Norm
					|| ?type = skoslex:Object
					|| ?type = skoslex:Actor
					|| ?type = owl:Class
					|| ?type = dctype:Text
				)
			}
			FILTER NOT EXISTS {
				GRAPH ?g {
					?s prov:invalidatedAtTime ?time.
				}
			}
		}
		
		DELETE FROM doc:mastergraph {
			?s ?p ?o
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s ?p ?o
			}
			GRAPH versiongraph:version {
				?s rdf:type ?type.
				FILTER (
					?type = skos:Concept
					|| ?type = skos:Collection
					|| ?type = skoslex:Act
					|| ?type = skoslex:Norm
					|| ?type = skoslex:Object
					|| ?type = skoslex:Actor
					|| ?type = owl:Class
					|| ?type = dctype:Text
				)
			}
		}

		INSERT INTO doc:mastergraph {
			?s rdf:type ?type.
			?s rdfs:isDefinedBy versiongraph:version.
			?s bp4mc2:signature ?sig
		}
		WHERE {
			GRAPH versiongraph:version {
			    ?s rdf:type ?type.
			    ?s bp4mc2:signature ?sig.
				FILTER (
					?type = skos:Concept
					|| ?type = skos:Collection
					|| ?type = skoslex:Act
					|| ?type = skoslex:Norm
					|| ?type = skoslex:Object
					|| ?type = skoslex:Actor
					|| ?type = owl:Class
					|| ?type = dctype:Text
				)
            }
		}
		
		CLEAR GRAPH container:generiek		
		CLEAR GRAPH container:excelupload		
		CLEAR GRAPH container:ttlupload
	''';
.
 
#
#
#
# BEHEER DATASETS
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# CONTAINERS
#

# Uploadcontainer datasets
container:datasetupload a elmo:Container;
	elmo:contains stage:TaxBeheermenu;
	elmo:contains stage:TaxFooter;
	elmo:representation elmo:UploadRepresentation;
	rdfs:label "Upload dataset-metadata via Turtle (.ttl)";
	elmo:query stage:TaxDatasetUploadScene;
.

#
# SCENES
#

# Algoritme:
#
# - Verwijder voor de zekerheid de @CURRENTMOMENT@ GRAPH
# - Vul mastergraph aan met nieuwe versie
# - Voeg metadata toe aan nieuwe conceptengraph, activiteitengraph en actorengraph
# - Hash genereren, zodat we kunnen vergelijken of er iets gewijzigd is aan een concept
# - Voeg voor de verwijderde concepten in de oude GRAPH wat metadata toe (prov:invalidatedAtTime)
# - Verwijder de signature van de verwijderde concepten uit de mastergraph
# - Update de aanpasdatum van de Catalogus, CatalogRecord en Dataset
# - Voeg in de nieuwe GRAPH de concepten toe die een andere hash dan de hash in de mastergraph hebben (d.w.z., die gewijzigd zijn)
# - Voeg voor de gewijzigde concepten in de oude GRAPH wat metadata toe (prov:invalidatedAtTime)
# - Verwijder de concepten uit de mastergraph die voorkomen in de nieuwe GRAPH (d.w.z. gewijzigd zijn)
# - Voeg een verwijzing toe in de mastergraph naar de nieuwe GRAPH voor de concepten die in de nieuwe GRAPH staan
# - Verwijder de (tijdelijke) graphs die gebruikt zijn door de uploadcontainers

# Uploadquery datasets
stage:TaxDatasetUploadScene a elmo:Scene;
	rdfs:label "Postquery inladen dataset-metadata";
	elmo:index "1";
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix skosxl: <http://www.w3.org/2008/05/skos-xl#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix dctype: <http://purl.org/dc/dcmitype/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix foaf: <http://xmlns.com/foaf/0.1/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix owl: <http://www.w3.org/2002/07/owl#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix loc: <http://pdok-ld-gck.in.kadaster.nl/id/>
		prefix versiongraph: <http://pdok-ld-gck.in.kadaster.nl/datasets/doc/@CURRENTMOMENT@>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix catalogus: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix activity: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/@CURRENTMOMENT@>
		prefix xsd: <http://www.w3.org/2001/XMLSchema#>
		prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
			
		
		DELETE FROM versiongraph:version {
            ?s?p?o
		}
		WHERE {
            GRAPH versiongraph:version {
                ?s?p?o
            }
		}
		
		INSERT INTO container:datasetupload {
			?s rdfs:label ?slabel.
		} WHERE {
			GRAPH container:datasetupload {
				{
					?s skos:prefLabel ?slabel.
					FILTER NOT EXISTS {
						?s rdfs:label ?slabel.
					}
				}
				UNION {
					?s skosxl:prefLabel/skosxl:literalForm ?slabel.
				}
				UNION {
					?s dct:title ?slabel.
					FILTER NOT EXISTS {
						?s rdfs:label ?slabel.
					}
				}
			}
		}
		
		INSERT INTO doc:mastergraph {
            doc:mastergraph rdf:type void:Dataset.
            doc:mastergraph rdfs:label "Concepten".
            versiongraph:version dct:isVersionOf doc:mastergraph.
            dataset:concepten rdf:type skos:ConceptScheme.
            dataset:concepten rdfs:label "Conceptschema".
		}
		
		INSERT INTO versiongraph:version {
            dataset:concepten rdfs:isDefinedBy versiongraph:version.
            versiongraph:version rdfs:label "Datasets en distributies - Tax-programma (publicatiedatum @CURRENTMOMENT@)".
            versiongraph:version prov:wasGeneratedBy activity:Upload.
			versiongraph:version rdf:type prov:Entity.
			versiongraph:version prov:generatedAtTime "@CURRENTMOMENT@".
			activity:Upload rdf:type prov:Activity.
			activity:Upload rdfs:label "Upload catalogus @CURRENTMOMENT@".
			activity:Upload prov:startedAtTime "@CURRENTMOMENT@".
			activity:Upload prov:wasAssociatedWith catalogus:tomcatUser.
			catalogus:tomcatUser rdf:type prov:Agent.
			catalogus:tomcatUser rdfs:label "Tomcat User".
			catalogus:tomcatUser foaf:givenName "Tomcat User".
			catalogus:tomcatUser foaf:mbox "tomcat@user.org".
			catalogus:tomcatUser prov:actedOnBehalfOf "Apache".
		}

		INSERT INTO container:datasetupload {
            ?s bp4mc2:signature ?sig.
		}
		WHERE {
			SELECT DISTINCT ?s bif:md5(sql:group_concat(concat(?p,'=',?o),';')) as ?sig
			WHERE {
				GRAPH container:datasetupload {
					SELECT ?s ?p ?o
					WHERE {
						?s ?p ?o.
						?s rdf:type ?type.
						FILTER (
							?type = dcat:Dataset
							|| ?type = dcat:Distribution
						)
					}
					ORDER BY ?s ?p ?o
				}
            }
		}
		
		INSERT {
			GRAPH ?g {
				?s prov:invalidatedAtTime "@CURRENTMOMENT@"
			}
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s rdfs:isDefinedBy ?g.
				?s rdf:type ?type.
				FILTER (
					?type = dcat:Dataset
					|| ?type = dcat:Distribution
				)
			}
			FILTER NOT EXISTS {
				GRAPH container:datasetupload {
					?s rdf:type ?type.
					FILTER (
						?type = dcat:Dataset
						|| ?type = dcat:Distribution
					)
				}
			}
			FILTER NOT EXISTS {
				GRAPH ?g {
					?s prov:invalidatedAtTime ?time.
				}
			}
		}
		
		DELETE FROM doc:mastergraph {
			?s bp4mc2:signature ?sig.
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s bp4mc2:signature ?sig.
				?s rdf:type ?type.
				FILTER (
					?type = dcat:Dataset
					|| ?type = dcat:Distribution
				)
			}
			FILTER NOT EXISTS {
				GRAPH container:datasetupload {
					?s rdf:type ?type.
					FILTER (
						?type = dcat:Dataset
						|| ?type = dcat:Distribution
					)
				}
			}
		}
			
		INSERT INTO versiongraph:version {
			?s ?p ?o
		}
		WHERE {
			GRAPH container:datasetupload {
				?s rdf:type ?type.
			    ?s ?p ?o.
			    ?s bp4mc2:signature ?sig
				FILTER (
					?type = dcat:Dataset
					|| ?type = dcat:Distribution
				)
			}
			FILTER NOT EXISTS {
				GRAPH doc:mastergraph {
					?s bp4mc2:signature ?sig
				}
			}
		}
		
		INSERT {
			GRAPH ?g {
				?s prov:invalidatedAtTime "@CURRENTMOMENT@"
			}
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s rdfs:isDefinedBy ?g
			}
			GRAPH versiongraph:version {
				?s rdf:type ?type.
				FILTER (
					?type = dcat:Dataset
					|| ?type = dcat:Distribution
				)
			}
			FILTER NOT EXISTS {
				GRAPH ?g {
					?s prov:invalidatedAtTime ?time.
				}
			}
		}
		
		DELETE FROM doc:mastergraph {
			?s ?p ?o
		}
		WHERE {
			GRAPH doc:mastergraph {
				?s ?p ?o
			}
			GRAPH versiongraph:version {
				?s rdf:type ?type.
				FILTER (
					?type = dcat:Dataset
					|| ?type = dcat:Distribution
				)
			}
		}

		INSERT INTO doc:mastergraph {
			?s rdf:type ?type.
			?s rdfs:isDefinedBy versiongraph:version.
			?s bp4mc2:signature ?sig
		}
		WHERE {
			GRAPH versiongraph:version {
			    ?s rdf:type ?type.
			    ?s bp4mc2:signature ?sig.
				FILTER (
					?type = dcat:Dataset
					|| ?type = dcat:Distribution
				)
            }
		}
		
		CLEAR GRAPH container:datasetupload
	''';
.
 
#
#
#
# CLEAR ALL DATA
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# PRODUCTIONS
#

# Speciale pagina om alle gegevens te wissen
# Deze backdoor moet zeer waarschijnlijk verwijderd worden uit de definitieve configuratie!
updatestage:clearalldata a elmo:Production;
	elmo:contains stage:TaxBeheermenu;
	elmo:contains stage:TaxFooter;
	elmo:queryForm stage:TaxDummyForm;
	elmo:contains stage:ClearAllDataScene;
.

# DummyForm nodig omdat anders de feedback vanuit de scenes niet getoond wordt
stage:TaxDummyForm a elmo:Form.


#
# SCENES
#

# Scene gebruikt voor het verwijderen van alle data
stage:ClearAllDataScene a elmo:Scene;
	elmo:index "1";
	rdfs:label "Verwijder alle data";
	elmo:query '''
		DELETE {
			GRAPH ?g {
				?s ?p ?o
			}
		}
		WHERE {
			GRAPH ?g {
				?s ?p ?o
			}
			FILTER regex(?g, "^http://pdok-ld-gck.in.kadaster.nl/(?!stage)")
		}
	'''
.
 
#
#
#
# WEERGAVEPAGINA'S
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.


# Onderstaande parts en query's zijn een template - deze kunnen gekopieerd worden, maar worden niet gebruikt in de configuratie.

# Tabel met vorige versies
stage:WeergaveVersies a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "90";
	elmo:fragment [
		elmo:applies-to "graph";
		elmo:name "graph";
		elmo:appearance elmo:HiddenAppearance;
	];
	elmo:fragment [
		elmo:applies-to "concept";
		rdfs:label "Andere versies";
		xhtml:link "/query/versie"
	];
	elmo:fragment [
		elmo:applies-to "actueeltot";
		rdfs:label "Actueel tot";
	];
	elmo:fragment [
		elmo:applies-to "slabel";
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		elmo:applies-to "graphlabel";
		rdfs:label "Datum versie"@nl;
	];
	
	elmo:query stage:WeergaveVersiesQuery;
.


# Algemene tabelweergave
stage:WeergaveTabel a elmo:Part;
	elmo:index "01";
	elmo:fragment [
		elmo:applies-to rdfs:label;
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		rdfs:label "Uitleg"@nl;
		elmo:applies-to skos:comment;
		elmo:index "2";
	];
	elmo:fragment [
		rdfs:label "Definitie"@nl;
		elmo:applies-to skos:definition;
		elmo:index "3";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:fragment [
		rdfs:label "Toelichting"@nl;
		elmo:applies-to skos:scopeNote;
		elmo:index "4";
	];
	elmo:fragment [ 
		rdfs:label "Bron"@nl;
		elmo:applies-to dct:source;
		elmo:appearance elmo:GlobalLink;
		elmo:index "5";
	];
	elmo:fragment [
		rdfs:label "Domein"@nl;
		elmo:applies-to skos:inScheme;
		elmo:index "6";
	];
	elmo:fragment [ 
		rdfs:label "Is specialisatie van"@nl;
		elmo:applies-to thes:broaderGeneric;
		elmo:index "7";
	];
	elmo:fragment [
		rdfs:label "Is generalisatie van"@nl;
		elmo:applies-to thes:narrowerGeneric;
		elmo:index "8";
	];
	elmo:fragment [ 
		rdfs:label "Is onderdeel van"@nl;
		elmo:applies-to thes:broaderPartitive;
		elmo:index "9";
	];
	elmo:fragment [
		rdfs:label "Bestaat uit"@nl;
		elmo:applies-to thes:narrowerPartitive;
		elmo:index "10";
	];
	elmo:fragment [
		rdfs:label "Heeft betrekking op"@nl;
		elmo:applies-to skos:semanticRelation;
		elmo:indx "11";
	];
	elmo:fragment [
		rdfs:label "Synoniemen"@nl;
		elmo:applies-to skos:altLabel;
		elmo:indx "12";
	];
	elmo:fragment [
		rdfs:label "Startdatum versie"@nl;
		elmo:applies-to prov:generatedAtTime;
		elmo:indx "13";
	];
	elmo:fragment [
		rdfs:label "Einddatum versie"@nl;
		elmo:applies-to prov:invalidatedAtTime;
		elmo:indx "14";
	];
	elmo:fragment [
		rdfs:label "Laatste activiteit"@nl;
		elmo:applies-to prov:wasGeneratedBy;
		elmo:indx "15";
	];
	elmo:fragment [
		rdfs:label "Lid van"@nl;
		elmo:applies-to skos:member;
		elmo:indx "16";
	];
		elmo:fragment [
		rdfs:label "Periode geldigheid"@nl;
		elmo:applies-to dct:valid;
		elmo:indx "17";
	];
	elmo:fragment [
		rdfs:label "Is gerealiseerd in"@nl;
		elmo:applies-to foaf:focus;
		elmo:index "18";
	];
	elmo:fragment [
		rdfs:label "Heeft als actor"@nl;
		elmo:applies-to skoslex:Actor;
		elmo:index "19";
	];
	elmo:fragment [
		rdfs:label "Heeft als object"@nl;
		elmo:applies-to skoslex:Object;
		elmo:index "20";
	];
	elmo:fragment [
		rdfs:label "Is ongeveer hetzelfde als"@nl;
		elmo:applies-to skos:closeMatch;
		elmo:index "21";
	];
	elmo:fragment [
		rdfs:label "Is hetzelfde als"@nl;
		elmo:applies-to skos:exactMatch;
		elmo:index "22";
	];		
	elmo:fragment [
		rdfs:label "zie ook (in ander schema)"@nl;
		elmo:applies-to skos:relatedMatch;
		elmo:index "23";
	];
	elmo:fragment [
		rdfs:label "Is breder dan (in ander schema)"@nl;
		elmo:applies-to skos:broadMatch;
		elmo:index "24";
	];
	elmo:fragment [
		rdfs:label "Is enger dan (in ander schema)"@nl;
		elmo:applies-to skos:narrowMatch;
		elmo:index "25";
	];
	elmo:fragment [
		rdfs:label "Regels die verwijzen naar dit concept"@nl;
		elmo:applies-to skoslex:refersTo;
		elmo:index "26";
	];
	elmo:fragment [
		rdfs:label "Startdatum"@nl;
		elmo:applies-to prov:startedAtTime;
		elmo:index "27";
	];
	elmo:fragment [
		rdfs:label "Einddatum"@nl;
		elmo:applies-to prov:endedAtTime;
		elmo:index "28";
	];
	elmo:fragment [
		rdfs:label "Uitgevoerd door"@nl;
		elmo:applies-to prov:wasAssociatedWith;
		elmo:index "29";
	];
	elmo:fragment [
		rdfs:label "Naam"@nl;
		elmo:applies-to foaf:givenName;
		elmo:index "30";
	];
	elmo:fragment [
		rdfs:label "Emailadres"@nl;
		elmo:applies-to foaf:mbox;
		elmo:index "31";
	];
	elmo:fragment [
		rdfs:label "Namens organisatie"@nl;
		elmo:applies-to prov:actedOnBehalfOf;
		elmo:index "32";
	];
	elmo:fragment [
		rdfs:label "Titel"@nl;
		elmo:applies-to dct:title;
		elmo:index "33";
	];
	elmo:fragment [
		rdfs:label "Beschrijving"@nl;
		elmo:applies-to dct:description;
		elmo:index "34";
	];
	elmo:fragment [
		rdfs:label "Gepubliceerd"@nl;
		elmo:applies-to dct:issued;
		elmo:index "35";
	];
	elmo:fragment [
		rdfs:label "Laatste wijziging"@nl;
		elmo:applies-to dct:modified;
		elmo:index "36";
	];
	elmo:fragment [
		rdfs:label "Taal"@nl;
		elmo:applies-to dct:language;
		elmo:index "37";
	];
	elmo:fragment [
		rdfs:label "Licentie"@nl;
		elmo:applies-to dct:license;
		elmo:index "38";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:fragment [
		rdfs:label "Rechten"@nl;
		elmo:applies-to dct:rights;
		elmo:index "39";
	];
	elmo:fragment [
		rdfs:label "Homepage"@nl;
		elmo:applies-to foaf:homepage;
		elmo:index "40";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:fragment [
		rdfs:label "Gepubliceerd door"@nl;
		elmo:applies-to dct:publisher;
		elmo:index "41";
	];
	elmo:fragment [
		rdfs:label "Werkingsgebied"@nl;
		elmo:applies-to dct:spatial;
		elmo:index "42";
	];
	elmo:fragment [
		rdfs:label "Thema-taxonomie"@nl;
		elmo:applies-to dcat:themeTaxonomy;
		elmo:index "43";
	];
	elmo:fragment [
		rdfs:label "Catalogus-onderdelen"@nl;
		elmo:applies-to dcat:record;
		elmo:index "44";
	];
	elmo:fragment [
		rdfs:label "Datasets"@nl;
		elmo:applies-to dcat:dataset;
		elmo:index "45";
	];
	elmo:fragment [
		rdfs:label "Primair onderwerp"@nl;
		elmo:applies-to foaf:primaryTopic;
		elmo:index "46";
	];
	elmo:fragment [
		rdfs:label "Identifier"@nl;
		elmo:applies-to dct:identifier;
		elmo:index "47";
	];
	elmo:fragment [
		rdfs:label "Distributie"@nl;
		elmo:applies-to dcat:distribution;
		elmo:index "48";
	];
	elmo:fragment [
		rdfs:label "URL"@nl;
		elmo:applies-to dcat:accessURL;
		elmo:index "49";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:fragment [
		rdfs:label "Website"@nl;
		elmo:applies-to dcat:landingPage;
		elmo:index "50";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:query stage:WeergaveTabelQuery;
.


# Query voor WeergaveTabel
stage:WeergaveTabelQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
		
		construct {
			<@SUBJECT@> ?p ?o.
			?o rdfs:label ?olabel.
			?o rdfs:label ?oelabel.
			<@SUBJECT@> skos:member ?col.
			?col rdfs:label ?col_label.
			<@SUBJECT@> prov:wasGeneratedBy ?a.
			<@SUBJECT@> prov:generatedAtTime ?t.
			?a rdfs:label ?alabel.
			?c rdfs:label ?clabel.
			<@SUBJECT@> skoslex:refersTo ?s.
			?s rdfs:label ?slabel.
		}
		WHERE {
			{
				{
					GRAPH ?g {
						<@SUBJECT@> ?p ?o.
						?g prov:wasGeneratedBy ?a.
						?g prov:generatedAtTime ?t.
					}
					GRAPH doc:mastergraph {
						<@SUBJECT@> rdfs:isDefinedBy ?g
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != dct:title
					)
					FILTER( substr("@GRAPH@",2) = "GRAPH@")
				}
				UNION
				{
					GRAPH <@GRAPH@> {
						<@SUBJECT@> ?p ?o.
						?g prov:wasGeneratedBy ?a.
						?g prov:generatedAtTime ?t.
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != dct:title
					)
					FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
				}
				UNION {
					{
						<@SUBJECT@> rdf:type prov:Activity.
						<@SUBJECT@> ?p ?o.
					}
					UNION
					{
						<@SUBJECT@> rdf:type prov:Agent.
						<@SUBJECT@> ?p ?o.
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != dct:title
					)
				}
				OPTIONAL {
					?o rdfs:label ?olabel.
				}
				OPTIONAL {
					?a rdfs:label ?alabel.
				}
				OPTIONAL {
					?c dct:title ?clabel.
				}	
				OPTIONAL {
					GRAPH doc:mastergraph {
						?col rdfs:isDefinedBy ?cg.
					}
					GRAPH ?cg {
						?col skos:member <@SUBJECT@>.
						?col rdfs:label ?col_label.
						FILTER NOT EXISTS {
							?col prov:invalidatedAtTime ?time.
						}
					}
				}
			}
			UNION {
				GRAPH doc:mastergraph {
					?s rdfs:isDefinedBy ?altSubjectGraph.
				}
				GRAPH ?altSubjectGraph {
					{ ?s skoslex:affects <@SUBJECT@> }
					UNION { ?s skoslex:classification <@SUBJECT@> }
					UNION { ?s skoslex:refersTo <@SUBJECT@> }
					FILTER NOT EXISTS {
						?s prov:invalidatedAtTime ?time.
					}
				}
				OPTIONAL {
					GRAPH <http://pdok-ld-gck.in.kadaster.nl/tr/container/dmn> {
						?s rdfs:label ?slabel.
					}
				}
			}
			UNION {
				SERVICE <http://almere.pilod.nl/sparql> {
					SERVICE <http://data.pdok.nl/sparql> {
						GRAPH brt:top10nl-metadata {
							<@SUBJECT@> ?p ?o.
						}
						FILTER (
							?p != rdf:type
							&& ?p != skos:prefLabel
							&& ?p != skos:notation
							&& ?p != bp4mc2:signature
							&& ?p != dct:type
							&& ?p != skos:member
						)				
						OPTIONAL {
							?o rdfs:label ?olabel.
						}
					}
				}
			}
		}
	'''
.


# Query voor weergave versies
stage:WeergaveVersiesQuery a elmo:Query;
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>

		SELECT DISTINCT (<@SUBJECT@> as ?concept) ?concept_label ?graph ?actueeltot
		WHERE {
			{
				GRAPH ?graph {
					<@SUBJECT@> rdf:type ?type.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					<@SUBJECT@> rdfs:isDefinedBy ?actualGraph.
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != ?actualGraph )
				FILTER( substr("@GRAPH@",2) = "GRAPH@" )
			}
			UNION {
				GRAPH ?graph {
					<@SUBJECT@> rdf:type ?type.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != <@GRAPH@> )
				FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
			}
		}
		ORDER BY DESC(lcase(?concept_label))
	'''
. 
@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# PAGINA'S (REPRESENTATIONS)
#

# Weergavepagina inclusief versies en grafische weergave
stage:WeergavePaginaConcepten a elmo:Representation;
	elmo:contains stage:TaxMenu;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxIndexConcepten;
	elmo:contains stage:WeergaveTabelConcepten;
	elmo:applies-to [ rdf:type skos:Concept ];
	elmo:uri-pattern "/id/concept/";
.

#
# HERBRUIKBARE PAGINA-ONDERDELEN (PARTS)
#

# Algemene tabelweergave
stage:WeergaveTabelConcepten a elmo:Part;
	elmo:index "01";
	elmo:fragment [
		elmo:applies-to rdfs:label;
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		rdfs:label "Uitleg"@nl;
		elmo:applies-to skos:comment;
		elmo:index "2";
	];
	elmo:fragment [
		rdfs:label "Definitie"@nl;
		elmo:applies-to skos:definition;
		elmo:index "3";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:fragment [
		rdfs:label "Toelichting"@nl;
		elmo:applies-to skos:scopeNote;
		elmo:index "4";
	];
	elmo:fragment [ 
		rdfs:label "Bron"@nl;
		elmo:applies-to dct:source;
		elmo:appearance elmo:GlobalLink;
		elmo:index "5";
	];
	elmo:fragment [
		rdfs:label "Domein"@nl;
		elmo:applies-to skos:inScheme;
		elmo:index "6";
	];
	elmo:fragment [ 
		rdfs:label "Is specialisatie van"@nl;
		elmo:applies-to thes:broaderGeneric;
		elmo:index "7";
	];
	elmo:fragment [
		rdfs:label "Is generalisatie van"@nl;
		elmo:applies-to thes:narrowerGeneric;
		elmo:index "8";
	];
	elmo:fragment [ 
		rdfs:label "Is onderdeel van"@nl;
		elmo:applies-to thes:broaderPartitive;
		elmo:index "9";
	];
	elmo:fragment [
		rdfs:label "Bestaat uit"@nl;
		elmo:applies-to thes:narrowerPartitive;
		elmo:index "10";
	];
	elmo:fragment [
		rdfs:label "Heeft betrekking op"@nl;
		elmo:applies-to skos:semanticRelation;
		elmo:indx "11";
	];
	elmo:fragment [
		rdfs:label "Synoniemen"@nl;
		elmo:applies-to skos:altLabel;
		elmo:indx "12";
	];
	elmo:fragment [
		rdfs:label "Lid van"@nl;
		elmo:applies-to skos:member;
		elmo:indx "16";
	];
	elmo:fragment [
		rdfs:label "Is ongeveer hetzelfde als"@nl;
		elmo:applies-to skos:closeMatch;
		elmo:index "21";
	];
	elmo:fragment [
		rdfs:label "Is hetzelfde als"@nl;
		elmo:applies-to skos:exactMatch;
		elmo:index "22";
	];		
	elmo:fragment [
		rdfs:label "zie ook (in ander schema)"@nl;
		elmo:applies-to skos:relatedMatch;
		elmo:index "23";
	];
	elmo:fragment [
		rdfs:label "Is breder dan (in ander schema)"@nl;
		elmo:applies-to skos:broadMatch;
		elmo:index "24";
	];
	elmo:fragment [
		rdfs:label "Is enger dan (in ander schema)"@nl;
		elmo:applies-to skos:narrowMatch;
		elmo:index "25";
	];
	elmo:query stage:WeergaveTabelConceptenQuery;
.

#
# QUERY'S VOOR PAGINA'S/PARTS
#

# Query voor WeergaveTabel
stage:WeergaveTabelConceptenQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
		
		construct {
			<@SUBJECT@> ?p ?o.
			?o rdfs:label ?olabel.
			<@SUBJECT@> skos:member ?col.
			?col rdfs:label ?col_label.
			<@SUBJECT@> skoslex:refersTo ?s.
			?s rdfs:label ?slabel.
		}
		WHERE {
			{
				{
					GRAPH ?g {
						<@SUBJECT@> ?p ?o.
						<@SUBJECT@> rdf:type skos:Concept.
					}
					GRAPH doc:mastergraph {
						<@SUBJECT@> rdfs:isDefinedBy ?g
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != prov:generatedAtTime
						&& ?p != prov:invalidatedAtTime
						&& ?p != prov:wasGeneratedBy
						&& ?p != dct:valid
						&& ?p != foaf:focus
						&& ?p != skoslex:Actor
						&& ?p != skoslex:Object
						&& ?p != prov:startedAtTime
						&& ?p != prov:endedAtTime
						&& ?p != prov:wasAssociatedWith
						&& ?p != prov:actedOnBehalfOf
					)
					FILTER( substr("@GRAPH@",2) = "GRAPH@")
				}
				UNION
				{
					GRAPH <@GRAPH@> {
						<@SUBJECT@> ?p ?o.
						<@SUBJECT@> rdf:type skos:Concept.
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != prov:generatedAtTime
						&& ?p != prov:invalidatedAtTime
						&& ?p != prov:wasGeneratedBy
						&& ?p != dct:valid
						&& ?p != foaf:focus
						&& ?p != skoslex:Actor
						&& ?p != skoslex:Object
						&& ?p != prov:startedAtTime
						&& ?p != prov:endedAtTime
						&& ?p != prov:wasAssociatedWith
						&& ?p != prov:actedOnBehalfOf
					)
					FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
				}
				OPTIONAL {
					?o rdfs:label ?olabel.
				}
				OPTIONAL {
					GRAPH doc:mastergraph {
						?col rdfs:isDefinedBy ?cg.
					}
					GRAPH ?cg {
						?col skos:member <@SUBJECT@>.
						?col rdfs:label ?col_label.
						FILTER NOT EXISTS {
							?col prov:invalidatedAtTime ?time.
						}
					}
				}
			}
			UNION {
				GRAPH doc:mastergraph {
					?s rdfs:isDefinedBy ?altSubjectGraph.
				}
				GRAPH ?altSubjectGraph {
					{ ?s skoslex:affects <@SUBJECT@> }
					UNION { ?s skoslex:classification <@SUBJECT@> }
					UNION { ?s skoslex:refersTo <@SUBJECT@> }
					FILTER NOT EXISTS {
						?s prov:invalidatedAtTime ?time.
					}
				}
				OPTIONAL {
					GRAPH <http://pdok-ld-gck.in.kadaster.nl/tr/container/dmn> {
						?s rdfs:label ?slabel.
					}
				}
			}
			UNION {
				SERVICE <http://almere.pilod.nl/sparql> {
					SERVICE <http://data.pdok.nl/sparql> {
						GRAPH brt:top10nl-metadata {
							<@SUBJECT@> ?p ?o.
						}
						FILTER (
							?p != rdf:type
							&& ?p != skos:prefLabel
							&& ?p != skos:notation
							&& ?p != bp4mc2:signature
							&& ?p != dct:type
							&& ?p != skos:member
							&& ?p != prov:generatedAtTime
							&& ?p != prov:invalidatedAtTime
							&& ?p != prov:wasGeneratedBy
							&& ?p != dct:valid
							&& ?p != foaf:focus
							&& ?p != skoslex:Actor
							&& ?p != skoslex:Object
							&& ?p != prov:startedAtTime
							&& ?p != prov:endedAtTime
							&& ?p != prov:wasAssociatedWith
							&& ?p != prov:actedOnBehalfOf
						)				
						OPTIONAL {
							?o rdfs:label ?olabel.
						}
					}
				}
			}
		}
	'''
. 
@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# PAGINA'S (REPRESENTATIONS)
#

# Weergavepagina inclusief versies en grafische weergave
stage:WeergavePaginaMetadataConcepten a elmo:Representation;
	elmo:contains stage:TaxMenu;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxIndexConcepten;
	elmo:contains stage:WeergaveTabelMetadata;
	elmo:contains stage:WeergaveVersiesConcepten;
	elmo:url-pattern "query/metadata";
.

#
# HERBRUIKBARE PAGINA-ONDERDELEN (PARTS)
#

# Algemene tabelweergave
stage:WeergaveTabelMetadata a elmo:Part;
	elmo:index "02";
	elmo:fragment [
		elmo:applies-to rdfs:label;
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		rdfs:label "Startdatum versie"@nl;
		elmo:applies-to prov:generatedAtTime;
		elmo:indx "13";
	];
	elmo:fragment [
		rdfs:label "Einddatum versie"@nl;
		elmo:applies-to prov:invalidatedAtTime;
		elmo:indx "14";
	];
	elmo:fragment [
		rdfs:label "Laatste activiteit"@nl;
		elmo:applies-to prov:wasGeneratedBy;
		elmo:indx "15";
	];
	elmo:fragment [
		rdfs:label "Periode geldigheid"@nl;
		elmo:applies-to dct:valid;
		elmo:indx "17";
	];
	elmo:fragment [
		rdfs:label "Is gerealiseerd in"@nl;
		elmo:applies-to foaf:focus;
		elmo:index "18";
	];
	elmo:fragment [
		rdfs:label "Heeft als actor"@nl;
		elmo:applies-to skoslex:Actor;
		elmo:index "19";
	];
	elmo:fragment [
		rdfs:label "Heeft als object"@nl;
		elmo:applies-to skoslex:Object;
		elmo:index "20";
	];
	elmo:fragment [
		rdfs:label "Startdatum"@nl;
		elmo:applies-to prov:startedAtTime;
		elmo:index "27";
	];
	elmo:fragment [
		rdfs:label "Einddatum"@nl;
		elmo:applies-to prov:endedAtTime;
		elmo:index "28";
	];
	elmo:fragment [
		rdfs:label "Uitgevoerd door"@nl;
		elmo:applies-to prov:wasAssociatedWith;
		elmo:index "29";
	];
	elmo:fragment [
		rdfs:label "Namens organisatie"@nl;
		elmo:applies-to prov:actedOnBehalfOf;
		elmo:index "32";
	];
	elmo:query stage:WeergaveTabelMetadataQuery;
.

# Tabel met vorige versies
stage:WeergaveVersiesConcepten a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "90";
	elmo:fragment [
		elmo:applies-to "graph";
		elmo:name "graph";
		elmo:appearance elmo:HiddenAppearance;
	];
	elmo:fragment [
		elmo:applies-to "concept";
		rdfs:label "Andere versies";
		xhtml:link "/query/versie"
	];
	elmo:fragment [
		elmo:applies-to "actueeltot";
		rdfs:label "Actueel tot";
	];
	elmo:fragment [
		elmo:applies-to "slabel";
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		elmo:applies-to "graphlabel";
		rdfs:label "Datum versie"@nl;
	];
	
	elmo:query stage:WeergaveVersiesConceptenQuery;
.

#
# QUERY'S VOOR PAGINA'S/PARTS
#

# Query voor WeergaveTabel
stage:WeergaveTabelMetadataQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
		
		construct {
			<@SUBJECT@> ?p ?o.
			?o rdfs:label ?olabel.
			?col rdfs:label ?col_label.
			<@SUBJECT@> prov:wasGeneratedBy ?a.
			<@SUBJECT@> prov:generatedAtTime ?t.
			?a rdfs:label ?alabel.
			?s rdfs:label ?slabel.
		}
		WHERE {
			{
				GRAPH ?g {
					<@SUBJECT@> ?p ?o.
					<@SUBJECT@> rdf:type skos:Concept.
					?g prov:wasGeneratedBy ?a.
					?g prov:generatedAtTime ?t.
				}
				GRAPH doc:mastergraph {
					<@SUBJECT@> rdfs:isDefinedBy ?g
				}
				FILTER (
					?p = prov:generatedAtTime
					|| ?p = prov:invalidatedAtTime
					|| ?p = prov:wasGeneratedBy
					|| ?p = dct:valid
					|| ?p = foaf:focus
					|| ?p = skoslex:Actor
					|| ?p = skoslex:Object
					|| ?p = prov:startedAtTime
					|| ?p = prov:endedAtTime
					|| ?p = prov:wasAssociatedWith
					|| ?p = prov:actedOnBehalfOf
					|| ?p = rdfs:label
				)
				FILTER( substr("@GRAPH@",2) = "GRAPH@")
			}
			UNION
			{
				GRAPH <@GRAPH@> {
					<@SUBJECT@> ?p ?o.
					<@SUBJECT@> rdf:type skos:Concept.
					<@GRAPH@> prov:wasGeneratedBy ?a.
					<@GRAPH@> prov:generatedAtTime ?t.
				}
				FILTER (
					?p = prov:generatedAtTime
					|| ?p = prov:invalidatedAtTime
					|| ?p = prov:wasGeneratedBy
					|| ?p = dct:valid
					|| ?p = foaf:focus
					|| ?p = skoslex:Actor
					|| ?p = skoslex:Object
					|| ?p = prov:startedAtTime
					|| ?p = prov:endedAtTime
					|| ?p = prov:wasAssociatedWith
					|| ?p = prov:actedOnBehalfOf
					|| ?p = rdfs:label
				)
				FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
			}
			OPTIONAL {
				?o rdfs:label ?olabel.
			}
			OPTIONAL {
				?a rdfs:label ?alabel.
			}
		}
	'''
.

# Query voor weergave versies
stage:WeergaveVersiesConceptenQuery a elmo:Query;
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		prefix skos: <http://www.w3.org/2004/02/skos/core#>

		SELECT DISTINCT (<@SUBJECT@> as ?concept) ?concept_label ?graph ?actueeltot
		WHERE {
			{
				GRAPH ?graph {
					<@SUBJECT@> rdf:type skos:Concept.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					<@SUBJECT@> rdfs:isDefinedBy ?actualGraph.
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != ?actualGraph )
				FILTER( substr("@GRAPH@",2) = "GRAPH@" )
			}
			UNION {
				GRAPH ?graph {
					<@SUBJECT@> rdf:type skos:Concept.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != <@GRAPH@> )
				FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
			}
		}
		ORDER BY DESC(lcase(?concept_label))
	'''
. 
#
#
#
# WEERGAVEPAGINA'S
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

# Weergavepagina inclusief boomweergave
stage:WeergavePaginaActivity a elmo:Representation;
	elmo:contains stage:TaxMenu;
	
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxIndexConcepten;
	elmo:contains stage:WeergaveTabelActivity;
	elmo:applies-to [
		rdf:type prov:Activity;
	];
.

stage:WeergavePaginaAgent a elmo:Representation;
	elmo:contains stage:TaxMenu;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxIndexConcepten;
	elmo:contains stage:WeergaveTabelAgent;
	elmo:applies-to [
		rdf:type prov:Agent;
	];
.

# Tabel met vorige versies
stage:WeergaveVersiesActivity a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "90";
	elmo:fragment [
		elmo:applies-to "graph";
		elmo:name "graph";
		elmo:appearance elmo:HiddenAppearance;
	];
	elmo:fragment [
		elmo:applies-to "concept";
		rdfs:label "Andere versies";
		xhtml:link "/query/versie"
	];
	elmo:fragment [
		elmo:applies-to "actueeltot";
		rdfs:label "Actueel tot";
	];
	elmo:fragment [
		elmo:applies-to "slabel";
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		elmo:applies-to "graphlabel";
		rdfs:label "Datum versie"@nl;
	];
	
	elmo:query stage:WeergaveVersiesActivityQuery;
.

stage:WeergaveVersiesAgent a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "90";
	elmo:fragment [
		elmo:applies-to "graph";
		elmo:name "graph";
		elmo:appearance elmo:HiddenAppearance;
	];
	elmo:fragment [
		elmo:applies-to "concept";
		rdfs:label "Andere versies";
		xhtml:link "/query/versie"
	];
	elmo:fragment [
		elmo:applies-to "actueeltot";
		rdfs:label "Actueel tot";
	];
	elmo:fragment [
		elmo:applies-to "slabel";
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		elmo:applies-to "graphlabel";
		rdfs:label "Datum versie"@nl;
	];
	
	elmo:query stage:WeergaveVersiesAgentQuery;
.


# Algemene tabelweergave
stage:WeergaveTabelActivity a elmo:Part;
	elmo:index "01";
	elmo:fragment [
		elmo:applies-to rdfs:label;
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		rdfs:label "Startdatum versie"@nl;
		elmo:applies-to prov:generatedAtTime;
		elmo:indx "13";
	];
	elmo:fragment [
		rdfs:label "Einddatum versie"@nl;
		elmo:applies-to prov:invalidatedAtTime;
		elmo:indx "14";
	];
	elmo:fragment [
		rdfs:label "Laatste activiteit"@nl;
		elmo:applies-to prov:wasGeneratedBy;
		elmo:indx "15";
	];
	elmo:fragment [
		rdfs:label "Periode geldigheid"@nl;
		elmo:applies-to dct:valid;
		elmo:indx "17";
	];
	elmo:fragment [
		rdfs:label "Startdatum"@nl;
		elmo:applies-to prov:startedAtTime;
		elmo:index "27";
	];
	elmo:fragment [
		rdfs:label "Einddatum"@nl;
		elmo:applies-to prov:endedAtTime;
		elmo:index "28";
	];
	elmo:fragment [
		rdfs:label "Uitgevoerd door"@nl;
		elmo:applies-to prov:wasAssociatedWith;
		elmo:index "29";
	];
	elmo:query stage:WeergaveTabelActivityQuery;
.

stage:WeergaveTabelAgent a elmo:Part;
	elmo:index "01";
	elmo:fragment [
		elmo:applies-to rdfs:label;
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		rdfs:label "Startdatum versie"@nl;
		elmo:applies-to prov:generatedAtTime;
		elmo:indx "13";
	];
	elmo:fragment [
		rdfs:label "Einddatum versie"@nl;
		elmo:applies-to prov:invalidatedAtTime;
		elmo:indx "14";
	];
	elmo:fragment [
		rdfs:label "Laatste activiteit"@nl;
		elmo:applies-to prov:wasGeneratedBy;
		elmo:indx "15";
	];
	elmo:fragment [
		rdfs:label "Periode geldigheid"@nl;
		elmo:applies-to dct:valid;
		elmo:indx "17";
	];
	elmo:fragment [
		rdfs:label "Uitgevoerd door"@nl;
		elmo:applies-to prov:wasAssociatedWith;
		elmo:index "29";
	];
	elmo:fragment [
		rdfs:label "Naam"@nl;
		elmo:applies-to foaf:givenName;
		elmo:index "30";
	];
	elmo:fragment [
		rdfs:label "Emailadres"@nl;
		elmo:applies-to foaf:mbox;
		elmo:index "31";
	];
	elmo:fragment [
		rdfs:label "Namens organisatie"@nl;
		elmo:applies-to prov:actedOnBehalfOf;
		elmo:index "32";
	];
	elmo:query stage:WeergaveTabelAgentQuery;
.


# Query voor WeergaveTabel
stage:WeergaveTabelActivityQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
		
		construct {
			<@SUBJECT@> ?p ?o.
			?o rdfs:label ?olabel.
			?o rdfs:label ?oelabel.
		}
		WHERE {
			<@SUBJECT@> rdf:type prov:Activity.
			<@SUBJECT@> ?p ?o.
			FILTER (
				?p != rdf:type
				&& ?p != skos:prefLabel
				&& ?p != skos:notation
				&& ?p != bp4mc2:signature
				&& ?p != dct:type
				&& ?p != skos:member
				&& ?p != dct:title
			)
			OPTIONAL {
				?o rdfs:label ?olabel.
			}
		}
	'''
.


# Query voor WeergaveTabel
stage:WeergaveTabelAgentQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
		
		construct {
			<@SUBJECT@> ?p ?o.
			?o rdfs:label ?olabel.
			?o rdfs:label ?oelabel.
		}
		WHERE {
			<@SUBJECT@> rdf:type prov:Agent.
			<@SUBJECT@> ?p ?o.
			FILTER (
				?p != rdf:type
				&& ?p != skos:prefLabel
				&& ?p != skos:notation
				&& ?p != bp4mc2:signature
				&& ?p != dct:type
				&& ?p != skos:member
				&& ?p != dct:title
			)
			OPTIONAL {
				?o rdfs:label ?olabel.
			}
		}
	'''
.


# Query voor weergave versies
stage:WeergaveVersiesActivityQuery a elmo:Query;
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>

		SELECT DISTINCT (<@SUBJECT@> as ?concept) ?concept_label ?graph ?actueeltot
		WHERE {
			{
				GRAPH ?graph {
					<@SUBJECT@> rdf:type prov:Activity.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					<@SUBJECT@> rdfs:isDefinedBy ?actualGraph.
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != ?actualGraph )
				FILTER( substr("@GRAPH@",2) = "GRAPH@" )
			}
			UNION {
				GRAPH ?graph {
					<@SUBJECT@> rdf:type prov:Activity.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != <@GRAPH@> )
				FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
			}
		}
		ORDER BY DESC(lcase(?concept_label))
	'''
.

# Query voor weergave versies
stage:WeergaveVersiesAgentQuery a elmo:Query;
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>

		SELECT DISTINCT (<@SUBJECT@> as ?concept) ?concept_label ?graph ?actueeltot
		WHERE {
			{
				GRAPH ?graph {
					<@SUBJECT@> rdf:type prov:Agent.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					<@SUBJECT@> rdfs:isDefinedBy ?actualGraph.
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != ?actualGraph )
				FILTER( substr("@GRAPH@",2) = "GRAPH@" )
			}
			UNION {
				GRAPH ?graph {
					<@SUBJECT@> rdf:type prov:Agent.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != <@GRAPH@> )
				FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
			}
		}
		ORDER BY DESC(lcase(?concept_label))
	'''
. 
#
#
#
# OVERZICHTSPAGINA
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# PAGINA'S (REPRESENTATIONS)
#

# Overzichtspagina concepten
stage:TaxOverzichtspagina rdf:type elmo:Representation;
	elmo:url-pattern "/query/overzichtspagina(|/|\\..+)$";
	elmo:url-pattern "/(|/)$";
	elmo:contains stage:TaxConceptentabel;
	elmo:contains stage:TaxIndexConcepten;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxMenu;
	elmo:contains stage:TaxWelkom;
.

#
# HERBRUIKBARE PAGINA-ONDERDELEN (PARTS)
#

# Index voor op de alfabetische weergave concepten
stage:TaxIndexConcepten a elmo:Part;
	elmo:appearance elmo:IndexAppearance;
	elmo:data [
		rdfs:label "0-9|a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z|toon alles";
		xhtml:link "/query/overzichtspagina";
		rdf:value "%5B0-9%5D|a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z|";
		elmo:name "term";
	];
	elmo:index "00";
.

# Conceptentabel voor op de alfabetische weergave concepten
stage:TaxConceptentabel a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:with-parameter "term";
	elmo:index "03";
	elmo:fragment [
		elmo:applies-to "uitleg";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:query stage:TaxConceptenQuery;
.

# Welkomsttekst
stage:TaxWelkom a elmo:Part;
	elmo:appearance elmo:HtmlAppearance;
	elmo:without-parameter "term";
	elmo:data [
		rdfs:label "Welkom";
		elmo:html '''
			<p>Welkom bij het woordenboek van het Kadaster. Dit woordenboek geeft een begrijpelijke uitleg bij moeilijke begrippen die het Kadaster gebruikt. Daarnaast is een formele definitie van de begrippen beschikbaar.</p>

			<p><b>Hoe werkt het?</b><br/>
			Klik op de beginletter van het begrip voor uitleg. Als u vervolgens op het begrip zelf klikt, ziet u ook de formele omschrijving. Ook vindt u zo aanvullende informatie, zoals links naar gerelateerde begrippen.</p>

			<p><b>Wetsartikelen</b><br/>
			Juridisch geldt altijd de tekst in de wet. Wanneer er begrippen uit de wet komen, is er een verwijzing naar de wetsartikelen opgenomen. Als u daar op klikt wordt u doorgestuurd naar de officiele website van de overheid waar alle wetteksten gepubliceerd staan. Op alle onderlijnde begrippen kan doorgeklikt worden.</p>

			<p>Opmerkingen of vragen over de uitleg in dit woordenboek kunt u doorgeven met dit <a href="https://formulieren.kadaster.nl/contact_begrippenlijst" target="_blank">formulier</a>.</p>
		'''^^rdf:html;
	]
.

#
# QUERY'S
#

# Query voor tonen alle concepten
stage:TaxConceptenQuery a elmo:Query;
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		
		SELECT ?concept ?concept_label ?uitleg
		WHERE {
			GRAPH ?g {
				{
					?concept rdf:type skos:Concept.
					?concept rdfs:label ?concept_label.
					OPTIONAL {
						?concept skos:definition ?uitleg
					}
				}
				UNION
				{
					?concept rdf:type skos:Concept.
					?concept skos:altLabel ?concept_label.
					OPTIONAL {
						?concept rdfs:label ?clabel.
						?concept skos:definition ?definition.
						BIND( CONCAT( "(Synoniem voor: ", ?clabel, ") ", ?definition ) AS ?uitleg )
					}
				}
				FILTER regex(?concept_label, '^[^a-z0-9]*@TERM@', 'i').
				FILTER NOT EXISTS {
					?concept prov:invalidatedAtTime ?time.
				}
			}
			GRAPH doc:mastergraph {
				?concept rdfs:isDefinedBy ?g
			}
		}
		ORDER BY lcase(?concept_label)
	'''
.
 
#
#
#
# SEARCH
#
#
#

@prefix stage: <http://pdok-ld-gck.in.kadaster.nl/stage#>.
@prefix updatestage: <http://pdok-ld-gck.in.kadaster.nl/update/>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xhtml: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#>.
@prefix skosax: <http://bp4mc2.org/skosax#>.
@prefix skoslex: <http://bp4mc2.org/def/skos-lex#>.
@prefix thes: <http://purl.org/iso25964/skos-thes#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix dct: <http://purl.org/dc/terms/>.
@prefix dctype: <http://purl.org/dc/dcmitype/>.
@prefix geosparql: <http://www.opengis.net/ont/geosparql#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix prov: <http://www.w3.org/ns/prov#>.
@prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>.
@prefix vcard: <http://www.w3.org/2006/vcard/ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix iso: <http://id.loc.gov/vocabulary/iso639-1/>.
@prefix dcat: <http://www.w3.org/ns/dcat#>.

#
# PAGINA'S (REPRESENTATIONS)
#

# Standaard zoekpagina
stage:TaxSearch a elmo:Representation;
	elmo:url-pattern "query/search";
	elmo:contains stage:TaxMenu;
	elmo:contains stage:TaxFooter;
	elmo:contains stage:TaxIndexConcepten;
	elmo:query stage:TaxSearchQuery;
.


#
# QUERY'S
#

# Zoekquery
stage:TaxSearchQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix container: <http://pdok-ld-gck.in.kadaster.nl/container/>
		prefix doc: <http://pdok-ld-gck.in.kadaster.nl/concepten/doc/>
		prefix dataset: <http://pdok-ld-gck.in.kadaster.nl/id/dataset/>
		prefix concept: <http://pdok-ld-gck.in.kadaster.nl/id/concept/>
		
		SELECT ?concept ?concept_label ?uitleg
		WHERE {
			GRAPH ?g {
				?concept rdf:type ?type.
				?concept rdfs:label ?concept_label.
				OPTIONAL {
					?concept skos:definition ?uitleg.
				}
				FILTER regex(?concept_label,'@TERM@','i').
				FILTER (
					?type = skos:Concept
					|| ?type = skos:Collection
				)
			}
			GRAPH doc:mastergraph {
				?concept rdfs:isDefinedBy ?g.
			}
		}
		ORDER BY lcase(?concept_label)
		LIMIT 100
	''';
.
 
