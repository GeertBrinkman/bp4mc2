#
# PAGINA'S (REPRESENTATIONS)
#

# Weergavepagina inclusief versies en grafische weergave
stage:WeergavePaginaConcepten a elmo:Representation;
	elmo:contains stage:DSOMenu;
	elmo:contains stage:DSOHeader;
	elmo:contains stage:DSOFooter;
	elmo:contains stage:DSOTree;
	elmo:contains stage:WeergaveTabelConcepten;
	elmo:contains stage:WeergaveVersiesConcepten;
	elmo:contains stage:WeergaveGrafischConcepten;
	elmo:applies-to [
		rdf:type skos:Concept
	];
	elmo:uri-pattern "/id/begrip/";
.

#
# HERBRUIKBARE PAGINA-ONDERDELEN (PARTS)
#

# Algemene tabelweergave
stage:WeergaveTabelConcepten a elmo:Part;
	elmo:index "01";
	elmo:fragment [
		elmo:applies-to rdfs:label;
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		rdfs:label "Notitie"@nl;
		elmo:applies-to skos:notation;
		elmo:index "1";
	];
	elmo:fragment [
		rdfs:label "Uitleg"@nl;
		elmo:applies-to skos:comment;
		elmo:index "2";
	];
	elmo:fragment [
		rdfs:label "Definitie"@nl;
		elmo:applies-to skos:definition;
		elmo:index "3";
		elmo:appearance elmo:MarkdownAppearance;
	];
	elmo:fragment [
		rdfs:label "Toelichting"@nl;
		elmo:applies-to skos:scopeNote;
		elmo:index "4";
	];
	elmo:fragment [ 
		rdfs:label "Bron"@nl;
		elmo:applies-to dct:source;
		elmo:appearance elmo:GlobalLink;
		elmo:index "5";
	];
	elmo:fragment [
		rdfs:label "Domein"@nl;
		elmo:applies-to skos:inScheme;
		elmo:index "6";
	];
	elmo:fragment [ 
		rdfs:label "Is specialisatie van"@nl;
		elmo:applies-to thes:broaderGeneric;
		elmo:index "7";
	];
	elmo:fragment [
		rdfs:label "Is generalisatie van"@nl;
		elmo:applies-to thes:narrowerGeneric;
		elmo:index "8";
	];
	elmo:fragment [ 
		rdfs:label "Is onderdeel van"@nl;
		elmo:applies-to thes:broaderPartitive;
		elmo:index "9";
	];
	elmo:fragment [
		rdfs:label "Bestaat uit"@nl;
		elmo:applies-to thes:narrowerPartitive;
		elmo:index "10";
	];
	elmo:fragment [
		rdfs:label "Heeft betrekking op"@nl;
		elmo:applies-to skos:semanticRelation;
		elmo:indx "11";
	];
	elmo:fragment [
		rdfs:label "Synoniemen"@nl;
		elmo:applies-to skos:altLabel;
		elmo:indx "12";
	];
	elmo:fragment [
		rdfs:label "Startdatum versie"@nl;
		elmo:applies-to prov:generatedAtTime;
		elmo:indx "13";
	];
	elmo:fragment [
		rdfs:label "Einddatum versie"@nl;
		elmo:applies-to prov:invalidatedAtTime;
		elmo:indx "14";
	];
	elmo:fragment [
		rdfs:label "Laatste activiteit"@nl;
		elmo:applies-to prov:wasGeneratedBy;
		elmo:indx "15";
	];
	elmo:fragment [
		rdfs:label "Lid van"@nl;
		elmo:applies-to skos:member;
		elmo:indx "16";
	];
	elmo:fragment [
		rdfs:label "Periode geldigheid"@nl;
		elmo:applies-to dct:valid;
		elmo:indx "17";
	];
	elmo:fragment [
		rdfs:label "Is gerealiseerd in"@nl;
		elmo:applies-to foaf:focus;
		elmo:index "18";
	];
	elmo:fragment [
		rdfs:label "Heeft als actor"@nl;
		elmo:applies-to skoslex:Actor;
		elmo:index "19";
	];
	elmo:fragment [
		rdfs:label "Heeft als object"@nl;
		elmo:applies-to skoslex:Object;
		elmo:index "20";
	];
	elmo:fragment [
		rdfs:label "Is ongeveer hetzelfde als"@nl;
		elmo:applies-to skos:closeMatch;
		elmo:index "21";
	];
	elmo:fragment [
		rdfs:label "Is hetzelfde als"@nl;
		elmo:applies-to skos:exactMatch;
		elmo:index "22";
	];		
	elmo:fragment [
		rdfs:label "zie ook (in ander schema)"@nl;
		elmo:applies-to skos:relatedMatch;
		elmo:index "23";
	];
	elmo:fragment [
		rdfs:label "Is breder dan (in ander schema)"@nl;
		elmo:applies-to skos:broadMatch;
		elmo:index "24";
	];
	elmo:fragment [
		rdfs:label "Is enger dan (in ander schema)"@nl;
		elmo:applies-to skos:narrowMatch;
		elmo:index "25";
	];
	elmo:fragment [
		rdfs:label "Regels die verwijzen naar dit concept"@nl;
		elmo:applies-to skoslex:refersTo;
		elmo:index "26";
	];
	elmo:fragment [
		rdfs:label "Startdatum"@nl;
		elmo:applies-to prov:startedAtTime;
		elmo:index "27";
	];
	elmo:fragment [
		rdfs:label "Einddatum"@nl;
		elmo:applies-to prov:endedAtTime;
		elmo:index "28";
	];
	elmo:fragment [
		rdfs:label "Uitgevoerd door"@nl;
		elmo:applies-to prov:wasAssociatedWith;
		elmo:index "29";
	];
	elmo:fragment [
		rdfs:label "Namens organisatie"@nl;
		elmo:applies-to prov:actedOnBehalfOf;
		elmo:index "32";
	];
	elmo:query stage:WeergaveTabelConceptenQuery;
.

# Grafische weergave
stage:WeergaveGrafischConcepten a elmo:Part;
	elmo:index "10";
	elmo:appearance elmo:GraphAppearance;
	elmo:fragment [
		elmo:applies-to "Concept";
		xhtml:stylesheet '''
			fill: red;
			fill-opacity: .3;
			stroke: #666;
		''';
		elmo:index "3";
	];
	elmo:fragment [
		elmo:applies-to "Collectie";
		xhtml:stylesheet '''
			fill: orange;
			fill-opacity: .3;
			stroke #666;
		''';
		elmo:index "4";
	];
	elmo:fragment [
		elmo:applies-to "Regeling";
		xhtml:stylesheet '''
			fill: gray;
			fill-opacity: .3;
			stroke #666;
		''';
		elmo:index "1";
	];
    elmo:fragment [
        elmo:applies-to "Gegevensklasse";
        xhtml:stylesheet '''
			fill: blue;
			fill-opacity: .3;
			stroke: #666;
		''';
		elmo:index "6";
    ];
	elmo:fragment [
		elmo:applies-to "Norm";
		xhtml:stylesheet '''
			fill: purple;
			fill-opacity: .3;
			stroke #666;
		''';
		elmo:index "2";
	];
	
	elmo:query stage:WeergaveGrafischConceptenQuery;
.

# Tabel met vorige versies
stage:WeergaveVersiesConcepten a elmo:Part;
	elmo:appearance elmo:TableAppearance;
	elmo:index "90";
	elmo:fragment [
		elmo:applies-to "graph";
		elmo:name "graph";
		elmo:appearance elmo:HiddenAppearance;
	];
	elmo:fragment [
		elmo:applies-to "concept";
		rdfs:label "Andere versies";
		xhtml:link "/catalogus/dso/query/versie"
	];
	elmo:fragment [
		elmo:applies-to "actueeltot";
		rdfs:label "Actueel tot";
	];
	elmo:fragment [
		elmo:applies-to "slabel";
		elmo:appearance elmo:HiddenAppearance
	];
	elmo:fragment [
		elmo:applies-to "graphlabel";
		rdfs:label "Datum versie"@nl;
	];
	
	elmo:query stage:WeergaveVersiesConceptenQuery;
.

#
# QUERY'S GRAFISCHE WEERGAVEN
#

# Query voor grafische weergave concepten e.d.
stage:WeergaveGrafischConceptenQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix dctype: <http://purl.org/dc/dcmitype/>
        prefix elmo: <http://bp4mc2.org/elmo/def#>
		prefix sh: <http://www.w3.org/ns/shacl#>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex/>
		prefix geosparql: <http://www.opengis.net/ont/geosparql#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix container: <http://localhost:8080/catalogus/dso/container/>
		prefix doc: <http://localhost:8080/catalogus/dso/concepten/doc/>
		prefix dataset: <http://localhost:8080/catalogus/dso/id/dataset/>
		prefix concept: <http://localhost:8080/catalogus/dso/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
	
		construct {
			<@SUBJECT@> ?p ?o.
			<@SUBJECT@> rdfs:label ?concept_label.
			<@SUBJECT@> elmo:style ?type.
			?o rdfs:label ?olabel.
			?o elmo:style ?otype.
			?s ?sp <@SUBJECT@>.
			?s rdfs:label ?slabel.
			?s elmo:style ?stype.
			skos:Concept elmo:name "Concept".
			skos:member rdfs:label "Lid van".
			skos:inScheme rdfs:label "Domein".
			skos:semanticRelation rdfs:label "Heeft betrekking op".
			thes:broaderGeneric rdfs:label "Is specialisatie van".
			thes:narrowerGeneric rdfs:label "Is generalisatie van".
			thes:broaderPartitive rdfs:label "Is onderdeel van".
			thes:narrowerPartitive rdfs:label "Bestaat uit".
			dc:source rdfs:label "Heeft als bron".
			skoslex:Actor rdfs:label "Heeft als actor".
			skoslex:Object rdfs:label "Heeft als object".
			owl:Class elmo:name "Gegevensklasse".
			owl:Class rdfs:label "Heeft als klasse".
			skoslex:Norm elmo:name "Norm".
			dctype:Text elmo:name "Regeling".
			skoslex:affects rdfs:label "Heeft invloed op".
			skoslex:refersTo rdfs:label "Verwijst naar".
			skoslex:classification rdfs:label "Classificatie".
			skos:Collection elmo:name "Collectie".
		}
		WHERE {
			{
				{
					GRAPH ?subjectGraph {
						<@SUBJECT@> rdf:type ?type.
						OPTIONAL {
							<@SUBJECT@> rdfs:label ?concept_label.
							<@SUBJECT@> ?p ?o.
						}
					}
					GRAPH ?objectGraph {
						?o rdfs:label ?olabel.
						?o rdf:type ?otype.
					}
					GRAPH doc:mastergraph {
						<@SUBJECT@> rdfs:isDefinedBy ?subjectGraph.
						?o rdfs:isDefinedBy ?objectGraph.
						?objectGraph dc:isVersionOf doc:mastergraph
					}
				}
				UNION
				{
					GRAPH ?altSubjectGraph {
						?s ?sp <@SUBJECT@>.
						?s rdf:type ?stype.
						OPTIONAL {
							?s rdfs:label ?slabel.
						}
						FILTER NOT EXISTS {
							?s prov:invalidatedAtTime ?time.
						}
					}
					OPTIONAL {
						GRAPH <http://localhost:8080/catalogus/tr/container/dmn> {
							?s rdfs:label ?slabel.
						}
					}
					GRAPH doc:mastergraph {
						?s rdfs:isDefinedBy ?altSubjectGraph.
					}
					OPTIONAL {
						<@SUBJECT@> rdfs:label ?concept_label.
						<@SUBJECT@> rdf:type ?type.
					}
				}
				FILTER ( substr("@GRAPH@",2) = "GRAPH@" )
			}
			UNION
			{
				{
					GRAPH <@GRAPH@> {
						<@SUBJECT@> rdf:type ?type.
						OPTIONAL {
							<@SUBJECT@> rdfs:label ?concept_label.
							<@SUBJECT@> ?p ?o.
						}
					}
					GRAPH ?objectGraph {
						?o rdfs:label ?olabel.
						?o rdf:type ?otype.
					}
					GRAPH doc:mastergraph {
						?o rdfs:isDefinedBy ?objectGraph.
						?objectGraph dc:isVersionOf doc:mastergraph
					}
				}
				UNION
				{
					GRAPH ?altSubjectGraph {
						?s ?sp <@SUBJECT@>.
						?s rdf:type ?stype.
						OPTIONAL {
							?s rdfs:label ?slabel.
						}
						FILTER NOT EXISTS {
							?s prov:invalidatedAtTime ?time.
						}
					}
					GRAPH doc:mastergraph {
						?s rdfs:isDefinedBy ?altSubjectGraph.
					}
					OPTIONAL {
						<@SUBJECT@> rdfs:label ?concept_label.
						<@SUBJECT@> rdf:type ?type.
					}
				}
				
				FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
			}
			UNION {
				SERVICE <http://almere.pilod.nl/sparql> {
					SERVICE <http://data.pdok.nl/sparql> {
						GRAPH brt:top10nl-metadata {
							{
								<@SUBJECT@> rdf:type ?type.
								OPTIONAL {
									<@SUBJECT@> rdfs:label ?concept_label.
									<@SUBJECT@> ?p ?o.
									?o rdfs:label ?olabel.
									?o rdf:type ?otype.
								}
							}
							UNION {
								?s ?sp <@SUBJECT@>.
								?s rdf:type ?stype.
								OPTIONAL {
									?s rdfs:label ?slabel.
								}
							}
						}
					}
				}
			}
		}
	''';
.


#
# QUERY'S VOOR PAGINA'S/PARTS
#


# Query voor WeergaveTabel
stage:WeergaveTabelConceptenQuery a elmo:Query;
	elmo:query '''
		prefix skos: <http://www.w3.org/2004/02/skos/core#>
		prefix dct: <http://purl.org/dc/terms/>
		prefix thes: <http://purl.org/iso25964/skos-thes#>
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix skoslex: <http://bp4mc2.org/def/skos-lex/>
		prefix container: <http://localhost:8080/catalogus/dso/container/>
		prefix doc: <http://localhost:8080/catalogus/dso/concepten/doc/>
		prefix dataset: <http://localhost:8080/catalogus/dso/id/dataset/>
		prefix concept: <http://localhost:8080/catalogus/dso/id/concept/>
		prefix brt: <http://brt.basisregistraties.overheid.nl/id/dataset/>
		prefix bp4mc2: <http://bp4mc2.org/elmo/def/>
		prefix dcat: <http://www.w3.org/ns/dcat#>
		
		construct {
			<@SUBJECT@> ?p ?o.
			?o rdfs:label ?olabel.
			?o rdfs:label ?oelabel.
			<@SUBJECT@> skos:member ?col.
			?col rdfs:label ?col_label.
			<@SUBJECT@> prov:wasGeneratedBy ?a.
			<@SUBJECT@> prov:generatedAtTime ?t.
			?a rdfs:label ?alabel.
			?c rdfs:label ?clabel.
			<@SUBJECT@> skoslex:refersTo ?s.
			?s rdfs:label ?slabel.
			<@SUBJECT@> skoslex:object ?act.
			?act rdfs:label ?actlabel.
		}
		WHERE {
			{
				{
					GRAPH ?g {
						<@SUBJECT@> ?p ?o.
						<@SUBJECT@> rdf:type skos:Concept.
						?g prov:wasGeneratedBy ?a.
						?g prov:generatedAtTime ?t.
					}
					GRAPH doc:mastergraph {
						<@SUBJECT@> rdfs:isDefinedBy ?g
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
					)
					FILTER( substr("@GRAPH@",2) = "GRAPH@")
				}
				UNION
				{
					GRAPH <@GRAPH@> {
						<@SUBJECT@> ?p ?o.
						<@SUBJECT@> rdf:type skos:Concept.
						?g prov:wasGeneratedBy ?a.
						?g prov:generatedAtTime ?t.
					}
					FILTER (
						?p != rdf:type
						&& ?p != skos:prefLabel
						&& ?p != skos:notation
						&& ?p != bp4mc2:signature
						&& ?p != dct:type
						&& ?p != skos:member
						&& ?p != dct:title
					)
					FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
				}
				OPTIONAL {
					?o rdfs:label ?olabel.
				}
				OPTIONAL {
					?a rdfs:label ?alabel.
				}
				OPTIONAL {
					GRAPH doc:mastergraph {
						?col rdfs:isDefinedBy ?cg.
					}
					GRAPH ?cg {
						?col skos:member <@SUBJECT@>.
						?col rdfs:label ?col_label.
						FILTER NOT EXISTS {
							?col prov:invalidatedAtTime ?time.
						}
					}
				}
			}
			UNION {
				GRAPH doc:mastergraph {
					?s rdfs:isDefinedBy ?altSubjectGraph.
				}
				GRAPH ?altSubjectGraph {
					{ ?s skoslex:affects <@SUBJECT@> }
					UNION { ?s skoslex:classification <@SUBJECT@> }
					UNION { ?s skoslex:refersTo <@SUBJECT@> }
					FILTER NOT EXISTS {
						?s prov:invalidatedAtTime ?time.
					}
				}
				OPTIONAL {
					GRAPH <http://localhost:8080/catalogus/tr/container/dmn> {
						?s rdfs:label ?slabel.
					}
				}
			}
			UNION {
				SERVICE <http://almere.pilod.nl/sparql> {
					SERVICE <http://data.pdok.nl/sparql> {
						GRAPH brt:top10nl-metadata {
							<@SUBJECT@> ?p ?o.
						}
						FILTER (
							?p != rdf:type
							&& ?p != skos:prefLabel
							&& ?p != skos:notation
							&& ?p != bp4mc2:signature
							&& ?p != dct:type
							&& ?p != skos:member
						)				
						OPTIONAL {
							?o rdfs:label ?olabel.
						}
					}
				}
			}
			UNION {
				SERVICE <http://localhost:8080/toepasbareregels/url> {
					?act skoslex:object <@SUBJECT@>.
					OPTIONAL {
						?act rdfs:label ?actlabel.
					}
				}
			}
		}
	'''
.

# Query voor weergave versies
stage:WeergaveVersiesConceptenQuery a elmo:Query;
	elmo:query '''
		prefix prov: <http://www.w3.org/ns/prov#>
		prefix dc: <http://purl.org/dc/terms/>
		prefix container: <http://localhost:8080/catalogus/dso/container/>
		prefix doc: <http://localhost:8080/catalogus/dso/concepten/doc/>
		prefix dataset: <http://localhost:8080/catalogus/dso/id/dataset/>
		prefix concept: <http://localhost:8080/catalogus/dso/id/concept/>
		prefix skos: <http://www.w3.org/2004/02/skos/core#>

		SELECT DISTINCT (<@SUBJECT@> as ?concept) ?concept_label ?graph ?actueeltot
		WHERE {
			{
				GRAPH ?graph {
					<@SUBJECT@> rdf:type skos:Concept.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					<@SUBJECT@> rdfs:isDefinedBy ?actualGraph.
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != ?actualGraph )
				FILTER( substr("@GRAPH@",2) = "GRAPH@" )
			}
			UNION {
				GRAPH ?graph {
					<@SUBJECT@> rdf:type skos:Concept.
					?graph prov:generatedAtTime ?concept_label.
					OPTIONAL {
						<@SUBJECT@> prov:invalidatedAtTime ?actueeltot.
					}
				}
				GRAPH doc:mastergraph {
					?graph dc:isVersionOf doc:mastergraph
				}	
				FILTER( ?graph != <@GRAPH@> )
				FILTER ( substr("@GRAPH@",2) != "GRAPH@" )
			}
		}
		ORDER BY DESC(lcase(?concept_label))
	'''
.