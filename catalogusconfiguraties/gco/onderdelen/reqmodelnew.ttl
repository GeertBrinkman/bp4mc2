@prefix stage: <http://localhost:8080/catalogus/gco/stage#>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix html: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix req: <http://data.ontwikkeling.pdok.nl/gco/id/requirement/>.

stage:ReqModelTotaal a elmo:Representation;
	elmo:url-pattern "/query/model/totaal$";
	elmo:appearance elmo:VocabularyAppearance;
	elmo:contains stage:Menu;
	elmo:query '''
		PREFIX sh: <http://www.w3.org/ns/shacl#>
		PREFIX dctype: <http://purl.org/dc/dcmitype/>
		CONSTRUCT {
			?s ?p ?o.
			?member skos:inScheme ?scheme.
			?member rdfs:label ?memberlabel
		}
		WHERE {
			GRAPH <http://bp4mc2.org/id/dataset/requirements> {
				?s?p?o
			}
			OPTIONAL {
				GRAPH <http://bp4mc2.org/id/dataset/imports> {
					?member skos:inScheme ?scheme.
					?member skos:prefLabel ?memberlabel
				}
			}
		}
	''';
.

stage:ReqFModelConcepten a elmo:Representation;
  elmo:url-pattern "/query/fmodel/concepten$";
  elmo:appearance elmo:VocabularyAppearance;
  elmo:contains stage:Menu;
  elmo:query '''
    PREFIX sh: <http://www.w3.org/ns/shacl#>
	CONSTRUCT {
      ?shape ?shapepred ?shapeobj.
      ?shape sh:property ?prop.
      ?prop ?proppred ?propobj.
    }
    WHERE {
      {
        GRAPH <@STAGE@> {
          <urn:ReqFModelConceptenShapes> rdfs:seeAlso ?shape
        }
        GRAPH <http://bp4mc2.org/id/dataset/requirements> {
          ?shape ?shapepred ?shapeobj.
          ?shape sh:property ?prop.
          ?prop ?proppred ?propobj
          FILTER NOT EXISTS {?prop sh:node ?refshape}
        }
      }
      UNION
      {
        GRAPH <@STAGE@> {
          <urn:ReqFModelConceptenShapes> rdfs:seeAlso ?shape.
          <urn:ReqFModelConceptenShapes> rdfs:seeAlso ?refshape.
        }
        GRAPH <http://bp4mc2.org/id/dataset/requirements> {
          ?shape sh:property ?prop.
          ?prop ?proppred ?propobj.
          ?prop sh:node ?refshape
        }
      }
    }
  ''';
.
<urn:ReqFModelConceptenShapes> rdfs:seeAlso req:Concept, req:ExternConcept, req:Begrippenkader, req:Collectie, req:Brondocument.
  

stage:ReqModelConcepten a elmo:Representation;
	elmo:url-pattern "/query/model/concepten$";
	elmo:appearance elmo:VocabularyAppearance;
	elmo:contains stage:Menu;
	elmo:query '''
		PREFIX sh: <http://www.w3.org/ns/shacl#>
		CONSTRUCT {
		  ?shape ?shapepred ?shapeobj.
		  ?shape sh:property ?prop.
		  ?prop ?proppred ?propobj.
      ?class rdfs:subClassOf ?parentclass.
      ?class rdf:type owl:Class.
      ?choice ?choiceprop ?list.
      ?listitem rdf:first ?refshape.
      ?listitem rdf:rest ?restlist.
		}
		WHERE {
		  {
        GRAPH <@STAGE@> {
          <urn:ReqModelConceptenShapes> rdfs:seeAlso ?shape
        }
        GRAPH <http://bp4mc2.org/id/dataset/requirements> {
          ?shape ?shapepred ?shapeobj.
          OPTIONAL {
            ?shape sh:property ?prop.
            ?prop ?proppred ?propobj.
          }
          OPTIONAL {
            ?shape sh:targetClass ?class.
            ?class rdfs:subClassOf ?parentclass.
          }
          FILTER NOT EXISTS {?prop sh:node ?refshape}
        }
		  }
		  UNION
		  {
        GRAPH <@STAGE@> {
          <urn:ReqModelConceptenShapes> rdfs:seeAlso ?shape.
          <urn:ReqModelConceptenShapes> rdfs:seeAlso ?refshape.
        }
        GRAPH <http://bp4mc2.org/id/dataset/requirements> {
          ?shape sh:property ?prop.
          ?prop ?proppred ?propobj.
          ?prop sh:node ?refshape
        }
		  }
      UNION
      {
        GRAPH <@STAGE@> {
          <urn:ReqModelConceptenShapes> rdfs:seeAlso ?shape.
          <urn:ReqModelConceptenShapes> rdfs:seeAlso ?refshape.
        }
        GRAPH <http://bp4mc2.org/id/dataset/requirements> {
          ?shape sh:property ?prop.
          ?prop ?proppred ?propobj.
          ?prop sh:node ?choice.
          ?choice ?choiceprop ?list.
          ?list rdf:rest* ?listitem.
          ?listitem rdf:first ?refshape.
          ?listitem rdf:rest ?restlist.
        }
      }
		}
	''';
.

<urn:ReqModelConceptenShapes> rdfs:seeAlso req:Concept, req:ExternConcept, req:Begrippenkader, req:Collectie, req:Brondocument, req:Bron, req:WerkAlsBron, req:ExpressieAlsBron.

stage:ReqModelConceptenMeta a elmo:Representation;
	elmo:url-pattern "/query/model/conceptenmeta$";
	elmo:appearance elmo:VocabularyAppearance;
	elmo:contains stage:Menu;
	elmo:query '''
	PREFIX sh: <http://www.w3.org/ns/shacl#>
	PREFIX dctype: <http://purl.org/dc/dcmitype/>
	PREFIX prov: <http://www.w3.org/ns/prov#>
	PREFIX dct: <http://purl.org/dc/terms/>
	PREFIX thes: <http://purl.org/iso25964/skos-thes#>
	prefix req: <http://data.ontwikkeling.pdok.nl/gco/id/requirement/>
	CONSTRUCT { 
		?shape ?shapepred ?shapeobj.
		?shape sh:targetclass ?type.
		?shape sh:property ?prop.
		?prop ?proppred ?propobj.
		?member skos:inScheme ?scheme.
		?member rdfs:label ?memberlabel
	}
	WHERE {
		GRAPH <http://bp4mc2.org/id/dataset/requirements> {
			{
				{
					?shape ?shapepred ?shapeobj.
					OPTIONAL {
						?shape sh:property ?prop.
						?prop ?proppred ?propobj.
					}
				}
				UNION
				{
					?shape sh:property ?typeprop.
					?typeprop sh:hasValue ?type.
					?typeprop sh:path rdf:type.
					OPTIONAL {
						?shape sh:property ?typeprop.
						?shape ?shapepred ?shapeobj.
						?shape sh:property ?prop.
						?prop ?proppred ?propobj.
					}
				}
				UNION
				{
					?shape sh:property ?memberprop.
					?memberprop sh:hasValue ?scheme.
					?memberprop sh:path skos:inScheme.
				}
			}
			FILTER (
				?shape = req:ConceptMetadata
				|| ?shape = req:Concept
				|| ?shape = req:Begrippenkader
				|| ?shape = req:Metadata
				|| ?shape = req:Collectie
        || ?shape = req:Metadata_Temporal
        || ?shape = req:Status
			)
			FILTER(
				?propobj != thes:broaderGeneric
				&& ?propobj != thes:broaderPartitive
				&& ?propobj != thes:narrowerGeneric
				&& ?propobj != thes:narrowerPartitive
				&& ?propobj != skos:semanticRelation
				&& ?propobj != skos:closeMatch
				&& ?propobj != skos:relatedMatch
				&& ?propobj != skos:exactMatch
				&& ?propobj != skos:broadMatch
				&& ?propobj != skos:narrowMatch
			)
		}
		OPTIONAL {
			GRAPH <http://bp4mc2.org/id/dataset/imports> {
				?member skos:inScheme ?scheme.
				?member skos:prefLabel ?memberlabel
			}
		}
	}
	''';
.

stage:ReqModelGebeurtenissen a elmo:Representation;
	elmo:url-pattern "/query/model/gebeurtenissen$";
	elmo:appearance elmo:VocabularyAppearance;
	elmo:contains stage:Menu;
	elmo:query '''
		PREFIX sh: <http://www.w3.org/ns/shacl#>
		PREFIX dctype: <http://purl.org/dc/dcmitype/>
		PREFIX skoslex: <http://bp4mc2.org/def/skos-lex#>
		PREFIX thes: <http://purl.org/iso25964/skos-thes#>
		CONSTRUCT {
			?shape ?shapepred ?shapeobj.
			?shape sh:targetclass ?type.
			?shape sh:property ?prop.
			?prop ?proppred ?propobj.
      ?type rdfs:subClassOf ?ptype.
      ?type rdf:type rdfs:Class. #Bug, type is needed
		}
		WHERE {
			GRAPH <http://bp4mc2.org/id/dataset/requirements> {
				?shape ?shapepred ?shapeobj.
				?shape sh:targetClass ?type.
				?shape sh:property ?prop.
				?prop ?proppred ?propobj.
        OPTIONAL {
          ?type rdfs:subClassOf ?ptype.
        }
				FILTER (
					?type = skos:Concept
				#	||	?type = skos:ConceptScheme
				#	||	?type = skos:Collection
				#	||	?type = dctype:Text
					||	?type = skoslex:Act
					||	?type = skoslex:Actor
					||	?type = skoslex:Agent
					||	?type = skoslex:Object
					||	?type = skoslex:Norm
				)
				FILTER(
					?propobj != thes:broaderGeneric
					&& ?propobj != thes:broaderPartitive
					&& ?propobj != thes:narrowerGeneric
					&& ?propobj != thes:narrowerPartitive
					&& ?propobj != skos:semanticRelation
					&& ?propobj != skos:closeMatch
					&& ?propobj != skos:relatedMatch
					&& ?propobj != skos:exactMatch
					&& ?propobj != skos:broadMatch
					&& ?propobj != skos:narrowMatch
				)
			}
		}
	''';
.

stage:ReqModelDatasets a elmo:Representation;
	elmo:url-pattern "/query/model/datasets$";
	elmo:appearance elmo:VocabularyAppearance;
	elmo:contains stage:Menu;
	elmo:query '''
		PREFIX sh: <http://www.w3.org/ns/shacl#>
		PREFIX dcat: <http://www.w3.org/ns/dcat#>
		CONSTRUCT {
			?shape ?shapepred ?shapeobj.
			?shape sh:targetclass ?type.
			?shape sh:property ?prop.
			?prop ?proppred ?propobj.
		}
		WHERE {
			GRAPH <http://bp4mc2.org/id/dataset/requirements> {
				?shape ?shapepred ?shapeobj.
				?shape sh:targetClass ?type.
				?shape sh:property ?prop.
				?prop ?proppred ?propobj.
				FILTER (?type = dcat:Catalog
					||	?type = dcat:Dataset
					||	?type = dcat:Distribution
				)
			}
		}
	''';
.

stage:ReqModelCatalogus a elmo:Representation;
	elmo:url-pattern "/query/model/catalogus$";
	elmo:appearance elmo:VocabularyAppearance;
	elmo:contains stage:Menu;
	
.

stage:ReqModelProvenance a elmo:Representation;
	elmo:url-pattern "/query/model/provenance$";
	elmo:appearance elmo:VocabularyAppearance;
	elmo:contains stage:Menu;
		elmo:query '''
		PREFIX sh: <http://www.w3.org/ns/shacl#>
		PREFIX dctype: <http://purl.org/dc/dcmitype/>
		PREFIX req: <http://data.ontwikkeling.pdok.nl/gco/id/requirement/>
		PREFIX thes: <http://purl.org/iso25964/skos-thes#>
		PREFIX dcat: <http://www.w3.org/ns/dcat#>
		PREFIX dct: <http://purl.org/dc/terms/>
		CONSTRUCT {
			?shape ?shapepred ?shapeobj.
			?shape sh:property ?prop.
			?prop ?proppred ?propobj.
		}
		WHERE {
			GRAPH <http://bp4mc2.org/id/dataset/requirements> {
				?shape ?shapepred ?shapeobj.
				OPTIONAL {
					?shape sh:property ?prop.
					?prop ?proppred ?propobj.
				}
				FILTER (?shape = req:Concept
				|| ?shape = req:Collectie
				|| ?shape = req:ProvenancePerson
				|| ?shape = req:ProvenanceOrganisation
				|| ?shape = req:Provenance
				|| ?shape = req:Catalogus
				|| ?shape = req:Dataset
				|| ?shape = req:Distributie
				|| ?shape = req:Metadata
        || ?shape = req:CatalogGraph
        || ?shape = req:Metadata_Temporal
        || ?shape = req:Status
				)
				FILTER(
					?propobj != thes:broaderGeneric
					&& ?propobj != thes:broaderPartitive
					&& ?propobj != thes:narrowerGeneric
					&& ?propobj != thes:narrowerPartitive
					&& ?propobj != skos:semanticRelation
					&& ?propobj != skos:closeMatch
					&& ?propobj != skos:relatedMatch
					&& ?propobj != skos:exactMatch
					&& ?propobj != skos:broadMatch
					&& ?propobj != skos:narrowMatch
					&& ?propobj != skos:member
					&& ?propobj != dcat:dataset
					&& ?propobj != dcat:distribution
					&& ?propobj != dct:relation
					&& ?propobj != dct:isVersionOf
				)
			}
		}
	''';
.


